function AccessError(){var e=Error.apply(this,arguments);e.name=this.name="AccessError",this.stack=e.stack,this.message=e.message}angular.module("zakaz-xd.main",["ui.router","zakaz-xd.auth","zakaz-xd.dialogs","zakaz-xd.auth.login-form","zakaz-xd.user-profile","zakaz-xd.orders.orders-list","zakaz-xd.orders.edit-order","zakaz-xd.orders.states","zakaz-xd.products.states","zakaz-xd.manage-users.states","zakaz-xd.user-profile.states","zakaz-xd.demo.states"]).config(["$stateProvider","$urlRouterProvider","ACCESS",function(e,r){e.state("login",{url:"/login",controller:"LoginFormCtrl",templateUrl:"app/main-pages/auth/login-form/login-form.tpl.html",resolve:{isAuthenticated:function(e,r){return r.isAuthenticated()},canGo:function(e,r){return r?e.reject("User already login"):e.when(!0)}}}).state("logout-success",{url:"/logout-success",templateUrl:"app/main-pages/auth/logout-success/logout-success.tpl.html"}).state("access-denied",{url:"/access-denied",templateUrl:"app/main-pages/auth/access-denied/access-denied.tpl.html"}).state("not-authenticated",{url:"/not-authenticated",templateUrl:"app/main-pages/auth/not-authenticated/not-authenticated.tpl.html"}),r.otherwise("/user-orders-list")}]).controller("ZakazXdCtrl",["$rootScope","$scope","$location","AuthService",function(){}]).controller("ZakazXdHeaderCtrl",["$rootScope","$scope","$state","AuthService","ErrorDialog",function(e,r,t,o,n){r.logout=function(){o.logout().then(function(){t.go("logout-success")},function(e){n.open(e.data,!0)})},o.isAuthenticated().then(function(e){e&&o.getCurrentUser()}),r.currentUser=function(){return o.currentUser()},r.isLogin=function(){return o.isLogin()},r.AuthService=o}]),angular.module("zakaz-xd.auth.access",[]).constant("ACCESS",{MANAGE_USERS:1,CREATE_ORDER:2,VIEW_OWN_ORDERS:4,EDIT_OWN_ORDER:8,REMOVE_OWN_ORDER:16,VIEW_ALL_ORDER:32,EDIT_ANY_ORDER:64,REMOVE_ANY_ORDER:128,CHANGE_OWN_PASSWORD:256,CHANGE_OWN_ROLE_LIST:512,VIEW_ROLES:1024,MANAGE_PRODUCTS:2048,MANAGE_ORDERS:4096}),angular.module("zakaz-xd.auth",["ngCookies","zakaz-xd.auth.access","zakaz-xd.resources.auth-resource","zakaz-xd.dialogs"]).run(["$rootScope","$state","AuthService","ErrorDialog",function(e,r,t,o){e.$on("$stateChangeError",function(e,r,n,u,s,a){e.preventDefault(),a instanceof AccessError?t.accessDenied():a.data?o.open(a.data):console.error(a)})}]).factory("AuthInterceptor",["$q","$cookies","AuthService",function(e,r,t){return{responseError:function(r){return r.config&&r.config.ignoreAuthInterceptor?e.reject(r):(401===r.status&&t.notAuthenticated(),403===r.status&&t.accessDenied(),e.reject(r))}}}]).config(["$httpProvider",function(e){e.interceptors.push("AuthInterceptor")}]).provider("AuthService",function(){this.$get=["$injector","$q","ACCESS",function(e,r,t){function o(){if(i)return i;var t=r.defer();return e.get("AuthResource").getCurrentUser().then(function(e){s=e.data,t.resolve(s),i=null},function(e){t.reject(e),i=null}),i=t.promise}function n(){var t=r.defer();return e.get("AuthResource").isAuthenticated().then(function(e){a=e.data,t.resolve(a)},function(e){t.reject(e)}),t.promise}function u(e,r){for(var t=0;t<e.roles.length;t++)for(var o=e.roles[t],n=0;n<o.accesses.length;n++){var u=o.accesses[n].value;if(r&u)return!0}return!1}var s=null,a=null,i=null;return{checkAccess:function(e){if(s)return u(s,e)?r.when("Current user is allowed access "+e):r.reject(new AccessError("Current user is not allowed access "+e));var t=r.defer();return o().then(function(r){u(r,e)?t.resolve("Current user is allowed access "+e):t.reject(new AccessError("Current user is not allowed access "+e))},function(e){t.reject(e)}),t.promise},hasAccess:function(e){return s?u(s,e):!1},hasAccessByCodes:function(e){if(!s)return!1;var r=e.split(",");if(0===r.length)return!0;for(var o=null,n=0;n<r.length;n++){var a=r[n],i=t[a];null!==i&&void 0!==i&&(o?o|=i:o=i)}return null===o?!1:u(s,o)},notAuthenticated:function(){a=!1,e.get("$state").go("login")},accessDenied:function(){e.get("$state").go("access-denied")},getCurrentUser:function(){return s?r.when(s):o()},reloadCurrentUser:function(){return s=null,o()},currentUser:function(){return s},isAuthenticated:function(){return null!==a?r.when(a):n()},isLogin:function(){return a},login:function(t,n){var u=r.defer();return e.get("AuthResource").login(t,n).then(function(){a=!0,o().then(function(e){u.resolve(e)},function(e){u.reject(e)})},function(e){u.reject(e)}),u.promise},logout:function(){var t=r.defer();return e.get("AuthResource").logout().then(function(e){a=null,s=null,i=null,t.resolve(e)},function(e){t.reject(e)}),t.promise}}}]}),angular.module("zakaz-xd.dialogs",["ui.bootstrap"]).factory("ErrorDialog",["$q","$modal","$sce",function(e,r){return{open:function(e,t){r.open({animation:!0,backdrop:"static",size:"lg",templateUrl:"app/dialogs/error-dialog.tpl.html",resolve:{},controller:function(r,o){r.error=e,r.printStack=t,r.error.status&&400===r.error.status&&(r.printStack=!1),r.close=function(){o.close()}}})}}}]).factory("InfoDialog",["$q","$modal","$sce",function(e,r,t){return{open:function(e,o){r.open({animation:!0,backdrop:"static",size:"lg",templateUrl:"app/dialogs/info-dialog.tpl.html",resolve:{},controller:function(r,n){r.message=t.trustAsHtml(e),r.title=o,r.close=function(){n.close()}}})}}}]).factory("YesNoDialog",["$q","$modal","$sce",function(e,r,t){return{open:function(e,o){var n=r.open({animation:!0,backdrop:"static",size:"lg",templateUrl:"app/dialogs/yes-no-dialog.tpl.html",resolve:{},controller:function(r){r.message=t.trustAsHtml(e),r.title=o,r.close=function(){r.$dismiss("NO")},r.yes=function(){r.$close("YES")},r.no=function(){r.$dismiss("NO")}}});return n.result}}}]).factory("ErrorHandler",["ErrorDialog",function(e){return{handle:function(r){e.open(r.data,!0)}}}]),AccessError.prototype=Object.create(Error.prototype,{constructor:{value:AccessError,writable:!0,configurable:!0}}),angular.module("zakaz-xd.resources.auth-resource",[]).factory("AuthResource",["$q","$http",function(e,r){var t="/auth";return{changePassword:function(e,o){return r.post(t+"/change-password",{newPassword:e,repeatNewPassword:o})},saveUser:function(e){return r.post(t+"/save-user",{user:e})},getCurrentUser:function(){return r.get(t+"/current-user",{headers:{"If-Modified-Since":"0"}})},login:function(e,o){var n={ignoreAuthInterceptor:!0};return r.post(t+"/login",{username:e,password:o},n)},logout:function(){return r.post(t+"/logout",{})},isAuthenticated:function(){return r.get(t+"/is-authenticated")}}}]),angular.module("zakaz-xd.resources.orders-resource",[]).factory("OrdersResource",["$q","$http",function(e,r){var t="/orders";return{createOrder:function(e){return r.post(t+"/create-order",{order:e})},editOrder:function(e){return r.post(t+"/edit-order",{order:e})},deleteOrder:function(e){return r.post(t+"/delete-order",{id:e})},getAllOrders:function(e){return r.get(t+"/all-orders",{params:e})},getAllUserOrders:function(e){return r.get(t+"/user-orders",{params:e})},getOrderById:function(e){return r.get(t+"/order-by-id",{params:{orderId:e}})},getAllOrderStatuses:function(){return r.get(t+"/all-order-statuses")},addOrderProduct:function(e,o){return r.post(t+"/add-order-product",{orderId:e,orderProduct:o})},updateOrderProduct:function(e,o){return r.post(t+"/update-order-product",{orderId:e,orderProduct:o})},removeOrderProduct:function(e,o){return r.post(t+"/remove-order-product",{orderId:e,orderProductId:o})},removeAllOrderProducts:function(e){return r.post(t+"/remove-all-order-products",{orderId:e})},activateOrder:function(e){return r.post(t+"/activate-order",{orderId:e})},approveOrder:function(e){return r.post(t+"/approve-order",{orderId:e})},shipOrder:function(e){return r.post(t+"/ship-order",{orderId:e})},closeOrder:function(e){return r.post(t+"/close-order",{orderId:e})},addOrderComment:function(e,o){return r.post(t+"/add-order-comment",{orderId:e,comment:o})},updateOrderComment:function(e,o){return r.post(t+"/update-order-comment",{orderId:e,comment:o})},removeOrderComment:function(e,o){return r.post(t+"/remove-order-comment",{orderId:e,orderCommentId:o})}}}]),angular.module("zakaz-xd.resources.products-resource",[]).factory("ProductsResource",["$q","$http",function(e,r){var t="/products";return{createProduct:function(e){return r.post(t+"/create-product",{product:e})},editProduct:function(e){return r.post(t+"/edit-product",{product:e})},deleteProduct:function(e){return r.post(t+"/delete-product",{id:e})},getAllProducts:function(e){return r.get(t+"/all-products",{params:e})},getProductById:function(e){return r.get(t+"/product-by-id",{params:{id:e}})},getAllMeasureUnits:function(){return r.get(t+"/all-measure-units")},getAllProductTypes:function(){return r.get(t+"/all-product-types")}}}]),angular.module("zakaz-xd.resources.roles-resource",[]).factory("RolesResource",["$q","$http",function(e,r){var t="/roles";return{getAllRoles:function(){return r.get(t+"/all-roles")}}}]),angular.module("zakaz-xd.resources.user-product-prices-resource",[]).factory("UserProductPricesResource",["$q","$http",function(e,r){var t="/user-product-prices";return{getProductUserPricesByUserProductId:function(e,o){return r.get(t+"/user-product-prices-by-user-product-id",{params:{id:e,page:o.page,itemsPerPage:o.itemsPerPage}})},createUserProductPrice:function(e){return r.post(t+"/create-user-product-price",{userProductPrice:e})},deleteUserProductPrice:function(e){return r.post(t+"/delete-user-product-price",{id:e})},editUserProductPrice:function(e){return r.post(t+"/edit-user-product-price",{userProductPrice:e})},getUserProductPriceById:function(e){return r.get(t+"/user-product-price-by-id",{params:{id:e}})}}}]),angular.module("zakaz-xd.resources.user-products-resource",[]).factory("UserProductsResource",["$q","$http",function(e,r){var t="/user-products";return{getProductUsersByProductId:function(e,o){return r.get(t+"/product-users-by-product-id",{params:{id:e,page:o.page,itemsPerPage:o.itemsPerPage}})},getProductUsersByCurrentUser:function(){return r.get(t+"/product-users-by-current-user",{params:{}})},getProductUsersByUserId:function(e){return r.get(t+"/product-users-by-user-id",{params:{userId:e}})},createUserProduct:function(e){return r.post(t+"/create-user-product",{userProduct:e})},deleteUserProduct:function(e){return r.post(t+"/delete-user-product",{id:e})},editUserProduct:function(e){return r.post(t+"/edit-user-product",{userProduct:e})},getUserProductById:function(e){return r.get(t+"/user-product-by-id",{params:{id:e}})}}}]),angular.module("zakaz-xd.resources.users-resource",[]).factory("UsersResource",["$q","$http",function(e,r){var t="/users";return{createUser:function(e){return r.post(t+"/create-user",{user:e})},editUser:function(e){return r.post(t+"/edit-user",{user:e})},changePassword:function(e){return r.post(t+"/change-password",e)},deleteUser:function(e){return r.post(t+"/delete-user",{userId:e})},lockUser:function(e){return r.post(t+"/lock-user",{userId:e})},unlockUser:function(e){return r.post(t+"/unlock-user",{userId:e})},getAllUsers:function(e){return r.get(t+"/all-users",{params:e})},getUserById:function(e){return r.get(t+"/user-by-id",{params:{userId:e}})},addUserDeliveryPoint:function(e,o){return r.post(t+"/add-user-delivery-point",{userId:e,deliveryPoint:o})},updateUserDeliveryPoint:function(e,o){return r.post(t+"/update-user-delivery-point",{userId:e,deliveryPoint:o})},removeUserDeliveryPoint:function(e,o){return r.post(t+"/remove-user-delivery-point",{userId:e,deliveryPointId:o})},removeAllUserDeliveryPoints:function(e){return r.post(t+"/remove-all-user-delivery-points",{userId:e})},addCurrentUserDeliveryPoint:function(e){return r.post(t+"/add-current-user-delivery-point",{deliveryPoint:e})},updateCurrentUserDeliveryPoint:function(e){return r.post(t+"/update-current-user-delivery-point",{deliveryPoint:e})},removeCurrentUserDeliveryPoint:function(e){return r.post(t+"/remove-current-user-delivery-point",{deliveryPointId:e})}}}]),angular.module("zakaz-xd.directives.datepicker",["ui.bootstrap"]).directive("zDatepicker",function(){return{restrict:"E",scope:{options:"=",ngModel:"=",required:"=",name:"@"},templateUrl:"app/directives/datepicker/z-datepicker.tpl.html",controller:function(e){e.format=e.options.format||"dd.MM.yyyy",null!==e.ngModel&&void 0!==e.ngModel&&"string"==typeof e.ngModel&&(e.ngModel=new Date(e.ngModel)),e.open=function(r){r.preventDefault(),r.stopPropagation(),e.opened=!0}}}}),angular.module("zakaz-xd.directives.decimal",["ui.bootstrap","ngSanitize"]).directive("lowercase",function(){return{restrict:"A",require:"ngModel",link:function(e,r,t,o){function n(e){return console.log("formatter",e),e?e.toUpperCase():void 0}o.$formatters.push(n)}}}).directive("banEnterZero",function(){return{restrict:"A",require:"ngModel",link:function(e,r,t,o){function n(r){if(!e.prevAppliedValue)return e.prevAppliedValue=r,r;var t=e.prevAppliedValue;if(null!==r&&void 0!==r&&null!==t&&void 0!==t){var n=parseFloat(r);if(null!=n&&0===n){var u=parseFloat(t);if(null==u||0!==u)return o.$setViewValue(t),o.$render(),t}}return e.prevAppliedValue=r,r}function u(r){return e.prevAppliedValue=r,r}o.$formatters.push(u),o.$parsers.push(n)}}}),angular.module("zakaz-xd.directives.my-dropdown",["ui.bootstrap"]).directive("myDropdown",function(){return{restrict:"E",scope:{},templateUrl:"app/directives/my-dropdown/my-dropdown.tpl.html",controller:function(e){e.open=function(){}}}}),angular.module("common.hcs-dropdown2",["ui.bootstrap.position"]).service("hcsDropdown2Utils",["$document","$window",function(e,r){var t;this.getBodyScrollbarWidth=function(){if(!t){var o=e.find("body");o.addClass("uib-position-body-scrollbar-measure"),t=r.innerWidth-o[0].clientWidth,t=isFinite(t)?t:0,o.removeClass("uib-position-body-scrollbar-measure")}return t}}]).controller("hcsDropdown2Ctrl",["$scope","$element","$attrs","$parse","dropdownService","$animate","$position","$document","hcsDropdown2Utils","$timeout",function(e,r,t,o,n,u,s,a,i,d){function c(e,t){function o(){var t=s.positionElements(r,p.dropdownMenu,"bottom-left",!0),o={top:t.top+"px",display:e?"block":"none"},n=p.dropdownMenu.hasClass("dropdown-menu-right");if(n){o.left="auto";var u=a[0].documentElement,d=i.getBodyScrollbarWidth(),c=u.scrollHeight>u.clientHeight;c&&d||(d=0),o.right=window.innerWidth-d-(t.left+r.prop("offsetWidth"))+"px"}else o.left=t.left+"px",o.right="auto";p.dropdownMenu.css(o)}p.dropdownMenu&&(t?(o(),d(o)):o())}var l,p=this,f=e.$new(),g=angular.noop,h=t.onToggle?o(t.onToggle):angular.noop,m=a.find("body");this.init=function(){t.isOpen&&(l=o(t.isOpen),g=l.assign,e.$watch(l,function(e){f.isOpen=!!e})),p.dropdownMenu&&(m.append(p.dropdownMenu),r.on("$destroy",function(){p.dropdownMenu.remove()}))},this.toggle=function(e){return f.isOpen=arguments.length?!!e:!f.isOpen,angular.isFunction(g)&&g(f,f.isOpen),f.isOpen},this.isOpen=function(){return f.isOpen},f.getToggleElement=function(){return p.toggleElement},f.getAutoClose=function(){return t.autoClose||"always"},f.getDropdownElement=function(){return p.dropdownMenu},f.focusToggleElement=function(){p.toggleElement&&p.toggleElement[0].focus()},$(window).on("resize.hcsDropdown2",function(){f.$apply(function(){f.isOpen&&(f.isOpen=!1)})}),f.$on("$destroy",function(){$(window).off("resize.hcsDropdown2")}),f.$watch("isOpen",function(r,t){c(r,!0),r?(f.focusToggleElement(),n.open(f)):n.close(f),angular.isFunction(g)&&g(e,r),angular.isDefined(r)&&r!==t&&h(e,{open:!!r})})}]).directive("hcsDropdown2",function(){return{controller:"hcsDropdown2Ctrl",link:function(e,r,t,o){o.init()}}}).directive("hcsDropdown2Menu",function(){return{restrict:"A",require:"?^hcsDropdown2",link:function(e,r,t,o){o&&(o.dropdownMenu||(o.dropdownMenu=r))}}}).directive("hcsDropdown2Toggle",function(){return{require:"?^hcsDropdown2",link:function(e,r,t,o){function n(n){n.preventDefault(),r.hasClass("disabled")||t.disabled||e.$apply(function(){o.toggle()})}o&&(o.toggleElement=r,r.on("click.hcsDropdown2",n),r.attr({"aria-haspopup":!0,"aria-expanded":!1}),e.$watch(o.isOpen,function(e){r.attr("aria-expanded",!!e)}),e.$on("$destroy",function(){r.off("click.hcsDropdown2",n)}))}}}),angular.module("zakaz-xd.directives.my.ui.mask",[]).value("myUiMaskConfig",{maskDefinitions:{9:/\d/,A:/[a-zA-Z]/,"*":/[a-zA-Z0-9]/},clearOnBlur:!0}).directive("myUiMask",["myUiMaskConfig","$parse",function(e,r){"use strict";return{priority:100,require:"ngModel",restrict:"A",compile:function(){var t=e;return function(e,o,n,u){function s(e){return angular.isDefined(e)?(z(e),L?(l(),p(),!0):c()):c()}function a(e){angular.isDefined(e)&&(I=e,L&&U())}function i(e){return L?(R=h(e||""),M=g(R),u.$setValidity("mask",M),M&&R.length?m(R):void 0):e}function d(e){return L?(R=h(e||""),M=g(R),u.$viewValue=R.length?m(R):"",u.$setValidity("mask",M),""===R&&n.required&&u.$setValidity("required",!u.$error.required),M?R:void 0):e}function c(){return L=!1,f(),angular.isDefined(G)?o.attr("placeholder",G):o.removeAttr("placeholder"),angular.isDefined(W)?o.attr("maxlength",W):o.removeAttr("maxlength"),o.val(u.$modelValue),u.$viewValue=u.$modelValue,!1}function l(){R=N=h(u.$viewValue||""),S=b=m(R),M=g(R);var e=M&&R.length?S:"";n.maxlength&&o.attr("maxlength",2*w[w.length-1]),o.attr("placeholder",I),o.val(e),u.$viewValue=e}function p(){V||(o.bind("blur",k),o.bind("mousedown mouseup",y),o.bind("input keyup click focus",U),V=!0)}function f(){V&&(o.unbind("blur",k),o.unbind("mousedown",y),o.unbind("mouseup",y),o.unbind("input",U),o.unbind("keyup",U),o.unbind("click",U),o.unbind("focus",U),V=!1)}function g(e){return e.length?e.length>=_:!0}function h(e){var r="",t=D.slice();return e=e.toString(),angular.forEach(O,function(r){e=e.replace(r,"")}),angular.forEach(e.split(""),function(e){t.length&&t[0].test(e)&&(r+=e,t.shift())}),r}function m(e){var r="",t=w.slice();return angular.forEach(I.split(""),function(o,n){e.length&&n===t[0]?(r+=e.charAt(0)||"_",e=e.substr(1),t.shift()):r+=o}),r}function v(e){var r=n.placeholder;return"undefined"!=typeof r&&r[e]?r[e]:"_"}function P(){return I.replace(/[_]+/g,"_").replace(/([^_]+)([a-zA-Z0-9])([^_])/g,"$1$2_$3").split("_")}function z(e){var r=0;if(w=[],D=[],I="","string"==typeof e){_=0;var t=!1,o=0,n=e.split("");angular.forEach(n,function(e,n){Y.maskDefinitions[e]?(w.push(r),I+=v(n-o),D.push(Y.maskDefinitions[e]),r++,t||_++):"?"===e?(t=!0,o++):(I+=e,r++)})}w.push(w.slice().pop()+1),O=P(),L=w.length>1?!0:!1}function k(){Y.clearOnBlur&&(T=0,B=0,M&&0!==R.length||(S="",o.val(""),e.$apply(function(){u.$setViewValue("")})))}function y(e){"mousedown"===e.type?o.bind("mouseout",A):o.unbind("mouseout",A)}function A(){B=E(this),o.unbind("mouseout",A)}function U(r){r=r||{};var t=r.which,n=r.type;if(16!==t&&91!==t){var s,a=o.val(),i=b,d=h(a),c=N,l=!1,p=C(this)||0,f=T||0,g=p-f,v=w[0],P=w[d.length]||w.slice().shift(),z=B||0,k=E(this)>0,y=z>0,A=a.length>i.length||z&&a.length>i.length-z,U=a.length<i.length||z&&a.length===i.length-z,D=t>=37&&40>=t&&r.shiftKey,I=37===t,O=8===t||"keyup"!==n&&U&&-1===g,_=46===t||"keyup"!==n&&U&&0===g&&!y,R=(I||O||"click"===n)&&p>v;if(B=E(this),!D&&(!k||"click"!==n&&"keyup"!==n)){if("input"===n&&U&&!y&&d===c){for(;O&&p>v&&!x(p);)p--;for(;_&&P>p&&-1===w.indexOf(p);)p++;var S=w.indexOf(p);d=d.substring(0,S)+d.substring(S+1),l=!0}for(s=m(d),b=s,N=d,o.val(s),l&&e.$apply(function(){u.$setViewValue(d)}),A&&v>=p&&(p=v+1),R&&p--,p=p>P?P:v>p?v:p;!x(p)&&p>v&&P>p;)p+=R?-1:1;(R&&P>p||A&&!x(f))&&p++,T=p,$(this,p)}}}function x(e){return w.indexOf(e)>-1}function C(e){if(!e)return 0;if(void 0!==e.selectionStart)return e.selectionStart;if(document.selection&&o.is(":focus")){e.focus();var r=document.selection.createRange();return r.moveStart("character",e.value?-e.value.length:0),r.text.length}return 0}function $(e,r){if(!e)return 0;if(0!==e.offsetWidth&&0!==e.offsetHeight)if(e.setSelectionRange)o.is(":focus")&&(e.focus(),e.setSelectionRange(r,r));else if(e.createTextRange){var t=e.createTextRange();t.collapse(!0),t.moveEnd("character",r),t.moveStart("character",r),t.select()}}function E(e){return e?void 0!==e.selectionStart?e.selectionEnd-e.selectionStart:document.selection?document.selection.createRange().text.length:0:0}var w,D,I,O,_,R,S,M,b,N,T,B,L=!1,V=!1,G=n.placeholder,W=n.maxlength,Y={};n.uiOptions?(Y=e.$eval("["+n.uiOptions+"]"),angular.isObject(Y[0])&&(Y=function(e,r){for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(void 0===r[t]?r[t]=angular.copy(e[t]):angular.extend(r[t],e[t]));return r}(t,Y[0]))):Y=t,n.$observe("myUiMask",s),n.$observe("placeholder",a);var q=!1;n.$observe("modelViewValue",function(e){"true"===e&&(q=!0)}),e.$watch(n.ngModel,function(t){if(q&&t){var o=r(n.ngModel);o.assign(e,u.$viewValue)}}),u.$formatters.push(i),u.$parsers.push(d),o.bind("mousedown mouseup",y),Array.prototype.indexOf||(Array.prototype.indexOf=function(e){if(null===this)throw new TypeError;var r=Object(this),t=r.length>>>0;if(0===t)return-1;var o=0;if(arguments.length>1&&(o=Number(arguments[1]),o!==o?o=0:0!==o&&1/0!==o&&o!==-1/0&&(o=(o>0||-1)*Math.floor(Math.abs(o)))),o>=t)return-1;for(var n=o>=0?o:Math.max(t-Math.abs(o),0);t>n;n++)if(n in r&&r[n]===e)return n;return-1})}}}}]),angular.module("zakaz-xd.directives.pagination",["ui.bootstrap"]).directive("zPagination",function(){return{restrict:"E",scope:{config:"=?",page:"=?"},templateUrl:"app/directives/pagination/z-pagination.tpl.html",controller:function(e){e.config.maxSize=e.config.maxSize||5}}}),angular.module("zakaz-xd.demo.states",["ui.router","zakaz-xd.auth","zakaz-xd.demo","zakaz-xd.demo2"]).config(["$stateProvider","$urlRouterProvider","ACCESS",function(e){e.state("demo",{url:"/demo",controller:"DemoCtrl",templateUrl:"app/main-pages/demo/demo.tpl.html",resolve:{}}).state("demo2",{url:"/demo2",controller:"Demo2Ctrl",templateUrl:"app/main-pages/demo/demo2.tpl.html",resolve:{}})}]),angular.module("zakaz-xd.demo",["zakaz-xd.directives.decimal","zakaz-xd.directives.my-dropdown","zakaz-xd.directives.my.ui.mask","ui.select","ngSanitize","ui.bootstrap","nvd3"]).factory("dateParserHelpers",[function(){var e={};return{getInteger:function(r,t,o,n){var u=r.substring(t),s=e[o+"_"+n];s||(s=new RegExp("^(\\d{"+o+","+n+"})"),e[o+"_"+n]=s);var a=s.exec(u);return a?a[1]:null}}}]).factory("$dateParser",["$locale","dateParserHelpers",function(e,r){var t=e.DATETIME_FORMATS,o=t.MONTH.concat(t.SHORTMONTH),n=t.DAY.concat(t.SHORTDAY);return function(e,u){if(angular.isDate(e))return e;try{if(e+="",u+="",!u.length)return new Date(e);t[u]&&(u=t[u]);for(var s=new Date,a=0,i=0,d="",c=s.getFullYear(),l=s.getMonth()+1,p=1,f=0,g=0,h=0,m=0,v="am",P=0,z=!1;i<u.length;){d=u.charAt(i);var k="";if("'"!=u.charAt(i)){for(;u.charAt(i)==d&&i<u.length;)k+=u.charAt(i++);if("yyyy"==k||"yy"==k||"y"==k){var y,A;if("yyyy"==k&&(y=4,A=4),"yy"==k&&(y=2,A=2),"y"==k&&(y=2,A=4),c=r.getInteger(e,a,y,A),null===c)throw"Invalid year";a+=c.length,2==c.length&&(c=c>70?1900+(c-0):2e3+(c-0))}else if("MMMM"===k||"MMM"==k){l=0;for(var U=0;U<o.length;U++){var x=o[U];if(e.substring(a,a+x.length).toLowerCase()==x.toLowerCase()){l=U+1,l>12&&(l-=12),a+=x.length;break}}if(1>l||l>12)throw"Invalid month"}else if("EEEE"==k||"EEE"==k)for(var C=0;C<n.length;C++){var $=n[C];if(e.substring(a,a+$.length).toLowerCase()==$.toLowerCase()){a+=$.length;break}}else if("MM"==k||"M"==k){if(l=r.getInteger(e,a,k.length,2),null===l||1>l||l>12)throw"Invalid month";a+=l.length}else if("dd"==k||"d"==k){if(p=r.getInteger(e,a,k.length,2),null===p||1>p||p>31)throw"Invalid date";a+=p.length}else if("HH"==k||"H"==k){if(f=r.getInteger(e,a,k.length,2),null===f||0>f||f>23)throw"Invalid hours";a+=f.length}else if("hh"==k||"h"==k){if(f=r.getInteger(e,a,k.length,2),null===f||0>f||f>12)throw"Invalid hours";a+=f.length}else if("mm"==k||"m"==k){if(g=r.getInteger(e,a,k.length,2),null===g||0>g||g>59)throw"Invalid minutes";a+=g.length}else if("ss"==k||"s"==k){if(h=r.getInteger(e,a,k.length,2),null===h||0>h||h>59)throw"Invalid seconds";a+=h.length}else if("sss"===k){if(m=r.getInteger(e,a,3,3),null===m||0>m||m>999)throw"Invalid milliseconds";a+=3}else if("a"==k){if("am"==e.substring(a,a+2).toLowerCase())v="AM";else{if("pm"!=e.substring(a,a+2).toLowerCase())throw"Invalid AM/PM";v="PM"}a+=2}else if("Z"==k){if(z=!0,"Z"===e[a])P=0,a+=1;else{":"===e[a+3]?(tzStr=e.substring(a,a+6),P=60*parseInt(tzStr.substr(0,3),10)+parseInt(tzStr.substr(4,2),10),a+=6):(tzStr=e.substring(a,a+5),P=60*parseInt(tzStr.substr(0,3),10)+parseInt(tzStr.substr(3,2),10),a+=5)}if(P>720||-720>P)throw"Invalid timezone"}else{if(e.substring(a,a+k.length)!=k)throw"Pattern value mismatch";a+=k.length}}else{for(;"'"!=u.charAt(++i)&&i<u.length;)k+=u.charAt(i);if(e.substring(a,a+k.length)!=k)throw"Pattern value mismatch";a+=k.length,i++}}if(a!=e.length)throw"Pattern value mismatch";if(c=parseInt(c,10),l=parseInt(l,10),p=parseInt(p,10),f=parseInt(f,10),g=parseInt(g,10),h=parseInt(h,10),m=parseInt(m,10),2==l)if(c%4===0&&c%100!==0||c%400===0){if(p>29)throw"Invalid date 29"}else if(p>28)throw"Invalid date 28";if((4==l||6==l||9==l||11==l)&&p>30)throw"Invalid date";12>f&&"PM"==v?f+=12:f>11&&"AM"==v&&(f-=12);var E=new Date(c,l-1,p,f,g,h,m);return z?new Date(E.getTime()-6e4*(P+E.getTimezoneOffset())):E}catch(w){return void 0}}}]).filter("month",function(){return function(e){var r=["Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь"],t=parseInt(e,10);return r[t-1]}}).controller("DemoCtrl",["$scope","$stateParams","$state","$modal","$filter","$dateParser",function(e,r,t,o,n,u){function s(r){var t=[{key:f.paid,values:[]},{key:f.charged,values:[]}];if(!r)return t;for(var o=0;o<r.length;++o){var n=r[o],s=n.periodMonth,a=e.getZeroIfNull(n.paid),d=e.getZeroIfNull(n.charged);s.toString().length<2&&(s="0"+s);var c=u(s+"."+n.periodYear,i);t[0].values.push({x:c,y:a,realValue:a}),t[1].values.push({x:c,y:Math.max(d-a,0),realValue:d})}return t}function a(){if(h.layer){var r=nv.utils.availableWidth(null,e.chartScope.svg,{left:117,right:0});console.log("$scope.chartScope",r),h.svg.selectAll(".nv-x.nv-axis .tick text").each(function(t,o){for(var n,u=d3.select(this),s=u.text().split(/\s+/).reverse(),a=0,i=1.1,d=u.attr("y"),c=parseFloat(u.attr("dy")),l=u.text(null);n=s.pop();)l=u.append("tspan").attr("x",0).attr("y",d).attr("dy",a*i+c+"em").text(n),++a;o%Math.ceil(e.chartData[0].values.length/(r/100))!==0&&u.style("opacity",0)})}}e.mask="99.99.9999",e.placeholder="ДД.ММ.ГГГГ",e.models={lowercase:"my test str",lowercase1:""},e.toggled=function(e){console.log("Dropdown is now: ",e)},e.openModal=function(){o.open({animation:!0,backdrop:"static",size:"lg",templateUrl:"app/main-pages/demo/test-dialog.tpl.html",resolve:{},controller:function(e,r){e.close=function(){r.close()}}})},e.models.banEnterZeroVal=0;var i="MM.yyyy",d="Начислено",c="Оплачено",l=", руб.",p=["#60B044","#BA1F0A"],f={charged:d+l,paid:c+l},g={};g[f.charged]=d,g[f.paid]=c,e.getZeroIfNull=function(e){return null!=e?e:0},e.chartData=[{key:f.paid,values:[]},{key:f.charged,values:[]}],e.updateChart=function(r){angular.forEach(e.chartData,function(e){e.values=[]}),angular.forEach(r,function(r){var t=r.periodMonth,o=e.getZeroIfNull(r.paid),n=e.getZeroIfNull(r.charged);t.toString().length<2&&(t="0"+t);var s=u(t+"."+r.periodYear,i);angular.forEach(e.chartData,function(e){switch(e.key){case f.charged:e.values.push([s,Math.max(n-o,0),n]);break;case f.paid:e.values.push([s,o,o])}})})},e.chartDataItems=[{periodYear:2015,periodMonth:9,charged:418.25,paid:10.45},{periodYear:2015,periodMonth:10,charged:0,paid:0},{periodYear:2015,periodMonth:11,charged:250,paid:50},{periodYear:2015,periodMonth:12,charged:0,paid:0},{periodYear:2016,periodMonth:1,charged:0,paid:0},{periodYear:2016,periodMonth:2,charged:0,paid:0}];var h={};e.chartApi={},e.chartScope={},e.onChartReady=function(r){var t=(r.api,r.chart,r.svg);e.chartScope=r;var o=t.selectAll(".nv-group"),n=o.selectAll("rect");h.layer=o,h.rect=n,h.svg=t,a()},e.chartOptions={chart:{type:"multiBarChart",stacked:!0,height:300,margin:{left:117,right:0},noData:"Данные за выбранный период отсутствуют!",color:function(e,r){return p[r]},reduceXTicks:!1,rotateLabels:0,showControls:!0,groupSpacing:.1,duration:0,dispatch:{beforeUpdate:function(){console.log("! before UPDATE !")},renderEnd:a},xAxis:{tickSize:0,tickFormat:function(e){return n("month")(e.getMonth()+1)+" "+e.getFullYear()+"г."}},yAxis:{tickFormat:function(e){return d3.format(".02f")(e)}}},callback:function(){console.log("! callback !")}},e.chartData=s(e.chartDataItems),console.log("chartData",e.chartData)}]),angular.module("zakaz-xd.demo2",["zakaz-xd.directives.decimal","zakaz-xd.directives.my-dropdown","common.hcs-dropdown2","zakaz-xd.directives.my.ui.mask","ui.select","ngSanitize","ui.bootstrap"]).controller("Demo2Ctrl",["$scope","$stateParams","$state","$modal","$filter","$dateParser",function(e){e.toggled=function(e){console.log("Dropdown is now: ",e)}}]),angular.module("zakaz-xd.manage-users.states",["ui.router","zakaz-xd.auth","zakaz-xd.dialogs","zakaz-xd.resources.users-resource","zakaz-xd.manage-users.users-list","zakaz-xd.manage-users.edit-user","zakaz-xd.manage-users.edit-user.change-password","zakaz-xd.manage-users.edit-user.delivery-point"]).config(["$stateProvider","$urlRouterProvider","ACCESS",function(e,r,t){e.state("users-list",{url:"/manage-users/users-list",controller:"UsersListCtrl",templateUrl:"app/main-pages/manage-users/users-list/users-list.tpl.html",resolve:{hasAccess:function(e,r){return r.checkAccess(t.MANAGE_USERS)}}}).state("edit-user",{url:"/manage-users/user/edit/:id",controller:"EditUserCtrl",templateUrl:"app/main-pages/manage-users/edit-user/edit-user.tpl.html",resolve:{hasAccess:function(e,r){return r.checkAccess(t.MANAGE_USERS)},user:function(e,r){return r.getUserById(e.id).then(function(e){return e.data})},allRoles:function(e,r){return r.getAllRoles().then(function(e){return e.data})}}}).state("create-user",{url:"/manage-users/user/create",controller:"EditUserCtrl",templateUrl:"app/main-pages/manage-users/edit-user/edit-user.tpl.html",resolve:{hasAccess:function(e,r){return r.checkAccess(t.MANAGE_USERS)},user:function(){return{}},allRoles:function(e,r){return r.getAllRoles().then(function(e){return e.data})}}}).state("change-user-password",{url:"/manage-users/user/change-password/:id",controller:"EditUserChangePasswordCtrl",templateUrl:"app/main-pages/manage-users/edit-user/change-password/edit-user-change-password.tpl.html",resolve:{hasAccess:function(e,r){return r.checkAccess(t.MANAGE_USERS)},user:function(e,r){return r.getUserById(e.id).then(function(e){return e.data})}}}).state("add-user-delivery-point",{url:"/manage-users/user/add-user-delivery-point/:id",controller:"EditUserDeliveryPointCtrl",templateUrl:"app/main-pages/manage-users/edit-user/delivery-point/edit-user-delivery-point.tpl.html",resolve:{hasAccess:function(e,r){return r.checkAccess(t.MANAGE_USERS)},deliveryPoint:function(){return{}},user:function(e,r){return r.getUserById(e.id).then(function(e){return e.data})}}}).state("edit-user-delivery-point",{url:"/manage-users/user/edit-user-delivery-point/:userId/:deliveryPointId",controller:"EditUserDeliveryPointCtrl",templateUrl:"app/main-pages/manage-users/edit-user/delivery-point/edit-user-delivery-point.tpl.html",resolve:{hasAccess:function(e,r){return r.checkAccess(t.MANAGE_USERS)},user:function(e,r){return r.getUserById(e.userId).then(function(e){return e.data})},deliveryPoint:function(e,r){for(var t=0;t<r.deliveryPoints.length;t++){var o=r.deliveryPoints[t];if(o._id===e.deliveryPointId)return o}return null}}})}]),angular.module("zakaz-xd.orders.states",["ui.router","zakaz-xd.auth","zakaz-xd.dialogs","zakaz-xd.resources.orders-resource","zakaz-xd.resources.users-resource","zakaz-xd.resources.user-products-resource","zakaz-xd.orders.orders-list","zakaz-xd.orders.all-orders-list","zakaz-xd.orders.edit-order","zakaz-xd.orders.edit-order-product"]).config(["$stateProvider","$urlRouterProvider","ACCESS",function(e,r,t){e.state("user-orders-list",{url:"/user-orders-list",controller:"OrdersListCtrl",templateUrl:"app/main-pages/orders/orders-list/orders-list.tpl.html",resolve:{user:function(e,r){return r.getCurrentUser()
},hasAccess:function(e,r){return r.checkAccess(t.EDIT_OWN_ORDER)}}}).state("all-orders",{url:"/all-orders",controller:"AllOrdersListCtrl",templateUrl:"app/main-pages/orders/all-orders-list/all-orders-list.tpl.html",resolve:{user:function(e,r){return r.getCurrentUser()},hasAccess:function(e,r){return r.checkAccess(t.MANAGE_ORDERS)}}}).state("edit-order",{url:"/order/edit/:id",controller:"EditOrderCtrl",templateUrl:"app/main-pages/orders/edit-order/edit-order.tpl.html",resolve:{hasAccess:function(e,r){return r.checkAccess(t.MANAGE_ORDERS|t.EDIT_OWN_ORDER)},order:function(e,r){return r.getOrderById(e.id).then(function(e){return e.data})},allOrderStatuses:function(e,r){return r.getAllOrderStatuses().then(function(e){return e.data})},user:function(e,r){return r.getCurrentUser()},author:function(e,r,t){return e._id!==r.author._id?t.getUserById(r.author._id).then(function(e){return e.data}):e}}}).state("create-order",{url:"/order/create",controller:"EditOrderCtrl",templateUrl:"app/main-pages/orders/edit-order/edit-order.tpl.html",resolve:{hasAccess:function(e,r){return r.checkAccess(t.MANAGE_ORDERS|t.EDIT_OWN_ORDER)},order:function(){return{}},allOrderStatuses:function(e,r){return r.getAllOrderStatuses().then(function(e){return e.data})},user:function(e,r){return r.getCurrentUser()},author:function(e){return e}}}).state("add-order-product",{url:"/order/add-product/:orderId",controller:"EditOrderProductCtrl",templateUrl:"app/main-pages/orders/edit-order-product/edit-order-product.tpl.html",resolve:{hasAccess:function(e,r){return r.checkAccess(t.MANAGE_ORDERS|t.EDIT_OWN_ORDER)},user:function(e,r){return r.getCurrentUser()},order:function(e,r){return r.getOrderById(e.orderId).then(function(e){return e.data})},orderProduct:function(){return{}},author:function(e,r,t){return e._id!==r.author._id?t.getUserById(r.author._id).then(function(e){return e.data}):e},userProducts:function(e,r,t,o){return r._id!==t._id?o.getProductUsersByUserId(t._id).then(function(e){return e.data}):o.getProductUsersByCurrentUser().then(function(e){return e.data})}}}).state("edit-order-product",{url:"/order/edit-product/:orderId/:orderProductId",controller:"EditOrderProductCtrl",templateUrl:"app/main-pages/orders/edit-order-product/edit-order-product.tpl.html",resolve:{hasAccess:function(e,r){return r.checkAccess(t.MANAGE_ORDERS|t.EDIT_OWN_ORDER)},user:function(e,r){return r.getCurrentUser()},order:function(e,r){return r.getOrderById(e.orderId).then(function(e){return e.data})},orderProduct:function(e,r){if(!r.authorProducts)return null;for(var t=0;t<r.authorProducts.length;t++){var o=r.authorProducts[t];if(o._id===e.orderProductId)return o}return null},author:function(e,r,t){return e._id!==r.author._id?t.getUserById(r.author._id).then(function(e){return e.data}):e},userProducts:function(e,r,t,o){return r._id!==t._id?o.getProductUsersByUserId(t._id).then(function(e){return e.data}):o.getProductUsersByCurrentUser().then(function(e){return e.data})}}})}]),angular.module("zakaz-xd.products.states",["ui.router","zakaz-xd.auth","zakaz-xd.dialogs","zakaz-xd.resources.products-resource","zakaz-xd.products.products-list","zakaz-xd.products.edit-product","zakaz-xd.user-products.states"]).config(["$stateProvider","$urlRouterProvider","ACCESS",function(e,r,t){e.state("products-list",{url:"/products-list",controller:"ProductsListCtrl",templateUrl:"app/main-pages/products/products-list/products-list.tpl.html",resolve:{user:function(e,r){return r.getCurrentUser()},hasAccess:function(e,r){return r.checkAccess(t.MANAGE_PRODUCTS)}}}).state("edit-product",{url:"/product/edit/:id",controller:"EditProductCtrl",templateUrl:"app/main-pages/products/edit-product/edit-product.tpl.html",resolve:{hasAccess:function(e,r){return r.checkAccess(t.MANAGE_PRODUCTS)},product:function(e,r){return r.getProductById(e.id).then(function(e){return e.data})},user:function(e,r){return r.getCurrentUser()},allMeasureUnits:function(e,r){return r.getAllMeasureUnits().then(function(e){return e.data})},allProductTypes:function(e,r){return r.getAllProductTypes().then(function(e){return e.data})}}}).state("create-product",{url:"/product/create",controller:"EditProductCtrl",templateUrl:"app/main-pages/products/edit-product/edit-product.tpl.html",resolve:{hasAccess:function(e,r){return r.checkAccess(t.MANAGE_PRODUCTS)},product:function(){return{}},user:function(e,r){return r.getCurrentUser()},allMeasureUnits:function(e,r){return r.getAllMeasureUnits().then(function(e){return e.data})},allProductTypes:function(e,r){return r.getAllProductTypes().then(function(e){return e.data})}}})}]),angular.module("zakaz-xd.user-products.states",["ui.router","zakaz-xd.auth","zakaz-xd.dialogs","zakaz-xd.resources.user-products-resource","zakaz-xd.resources.user-product-prices-resource","zakaz-xd.resources.products-resource","zakaz-xd.user-products.product-users-list","zakaz-xd.user-products.edit-user-product","zakaz-xd.user-product-prices.edit-user-product-price"]).config(["$stateProvider","$urlRouterProvider","ACCESS",function(e,r,t){e.state("product-users-list",{url:"/product-users-list/:id",controller:"ProductUsersListCtrl",templateUrl:"app/main-pages/user-products/product-users-list/product-users-list.tpl.html",resolve:{product:function(e,r){return r.getProductById(e.id).then(function(e){return e.data})},hasAccess:function(e,r){return r.checkAccess(t.MANAGE_PRODUCTS)}}}).state("create-user-product",{url:"/product/user-product/create/:productId",controller:"EditUserProductCtrl",templateUrl:"app/main-pages/user-products/edit-user-product/edit-user-product.tpl.html",resolve:{hasAccess:function(e,r){return r.checkAccess(t.MANAGE_PRODUCTS)},product:function(e,r){return r.getProductById(e.productId).then(function(e){return e.data})},userProduct:function(e){return{product:e}}}}).state("edit-user-product",{url:"/product/user-product/edit/:userProductId",controller:"EditUserProductCtrl",templateUrl:"app/main-pages/user-products/edit-user-product/edit-user-product.tpl.html",resolve:{hasAccess:function(e,r){return r.checkAccess(t.MANAGE_PRODUCTS)},userProduct:function(e,r){return r.getUserProductById(e.userProductId).then(function(e){return e.data})},product:function(e,r,t){return r.getProductById(t.product._id).then(function(e){return e.data})}}}).state("add-user-product-price",{url:"/product/user-product/add-user-product-price/:userProductId",controller:"EditUserProductPriceCtrl",templateUrl:"app/main-pages/user-products/edit-user-product-price/edit-user-product-price.tpl.html",resolve:{hasAccess:function(e,r){return r.checkAccess(t.MANAGE_PRODUCTS)},userProductPrice:function(e,r){return r.getUserProductById(e.userProductId).then(function(e){return{userProduct:e.data}})}}}).state("edit-user-product-price",{url:"/product/user-product/edit-user-product-price/:userProductPriceId",controller:"EditUserProductPriceCtrl",templateUrl:"app/main-pages/user-products/edit-user-product-price/edit-user-product-price.tpl.html",resolve:{hasAccess:function(e,r){return r.checkAccess(t.MANAGE_PRODUCTS)},userProductPrice:function(e,r){return r.getUserProductPriceById(e.userProductPriceId).then(function(e){return e.data})}}})}]),angular.module("zakaz-xd.user-profile.states",["ui.router","zakaz-xd.auth","zakaz-xd.dialogs","zakaz-xd.resources.users-resource"]).config(["$stateProvider","$urlRouterProvider","ACCESS",function(e,r,t){e.state("user-profile",{url:"/profile",controller:"UserProfileCtrl",templateUrl:"app/main-pages/user-profile/user-profile.tpl.html",resolve:{user:function(e,r){return r.getCurrentUser()}}}).state("user-profile-change-password",{url:"/profile/change-password",controller:"UserProfileCtrl",templateUrl:"app/main-pages/user-profile/user-profile-change-password.tpl.html",resolve:{user:function(e,r){return r.getCurrentUser()},hasAccess:function(e,r){return r.checkAccess(t.CHANGE_OWN_PASSWORD)}}}).state("user-profile-add-delivery-point",{url:"/profile/add-delivery-point",controller:"UserProfileDeliveryPointCtrl",templateUrl:"app/main-pages/user-profile/delivery-point/delivery-point.tpl.html",resolve:{hasAccess:function(e,r){return r.checkAccess(t.EDIT_OWN_ORDER)},deliveryPoint:function(){return{}},user:function(e,r){return r.getCurrentUser()}}}).state("user-profile-edit-delivery-point",{url:"/profile/edit-delivery-point/:deliveryPointId",controller:"UserProfileDeliveryPointCtrl",templateUrl:"app/main-pages/user-profile/delivery-point/delivery-point.tpl.html",resolve:{hasAccess:function(e,r){return r.checkAccess(t.EDIT_OWN_ORDER)},user:function(e,r){return r.getCurrentUser()},deliveryPoint:function(e,r){for(var t=0;t<r.deliveryPoints.length;t++){var o=r.deliveryPoints[t];if(o._id===e.deliveryPointId)return o}return null}}})}]),angular.module("zakaz-xd.user-profile",["zakaz-xd.dialogs","zakaz-xd.resources.auth-resource","zakaz-xd.auth","zakaz-xd.user-profile.states","zakaz-xd.user-profile.delivery-point"]).controller("UserProfileCtrl",["$scope","$stateParams","$state","$http","user","AuthResource","ErrorDialog","InfoDialog","AuthService",function(e,r,t,o,n,u,s,a,i){e.user=angular.copy(n),e.data={newPassword:null,repeatNewPassword:null},e.save=function(r){return r?!1:(u.saveUser(e.user).then(function(){i.reloadCurrentUser().then(function(r){e.user=angular.copy(r),a.open("Успешное сохранение изменений","Сохранение изменений")},function(e){s.open(e,!0)})},function(e){s.open(e,!0)}),void 0)},e.changePassword=function(r){return r?!1:e.data.newPassword!==e.data.repeatNewPassword?s.open({message:"Пароли не совпадают"}):(u.changePassword(e.data.newPassword,e.data.repeatNewPassword).then(function(){a.open('Ваш пароль успешно <span style="color: blue;"> изменен <span>',"Изменение пароля")},function(e){s.open(e,!0)}),void 0)}}]),angular.module("zakaz-xd.auth.login-form",["zakaz-xd.auth","zakaz-xd.dialogs"]).controller("LoginFormCtrl",["$scope","$stateParams","$state","AuthService","ErrorDialog",function(e,r,t,o,n){e.credentials={username:null,password:null,rememberMe:null},e.login=function(r){return r?!1:(o.login(e.credentials.username,e.credentials.password).then(function(){e.errorMsg=null,t.go("user-orders-list")},function(e){n.open(e.data)}),void 0)}}]),angular.module("zakaz-xd.manage-users.edit-user",["zakaz-xd.dialogs","zakaz-xd.resources.users-resource","zakaz-xd.resources.roles-resource","zakaz-xd.auth"]).controller("EditUserCtrl",["$scope","$stateParams","$state","UsersResource","ErrorDialog","InfoDialog","YesNoDialog","user","allRoles",function(e,r,t,o,n,u,s,a,i){function d(e,r){if(r.roles){for(var t={},o=0;o<e.length;o++){var n=e[o];t[n._id]=n}for(var u=0;u<r.roles.length;u++){var s=r.roles[u];t[s._id]&&(t[s._id].checked=!0)}}}function c(e,r){for(var t=[],o=0;o<e.length;o++){var n=e[o];n.checked&&t.push(n)}r.roles=t}e.isCreate=!a._id,e.allRoles=i,e.user=a,e.user.roles||(e.user.roles=[]),d(i,a),e.save=function(r){return r?!1:(c(e.allRoles,e.user),e.isCreate?o.createUser(e.user).then(function(){u.open("Пользователь успешно добавлен"),t.go("users-list")},function(e){n.open(e.data,!0)}):o.editUser(e.user).then(function(){u.open("Пользователь успешно сохранен"),t.go("users-list")},function(e){n.open(e.data,!0)}),void 0)},e.lockUser=function(){s.open("Вы действительно хотите заблокировать пользователя?").then(function(){o.lockUser(e.user._id).then(function(){u.open("Пользователь заблокирован"),t.go("edit-user",{id:e.user._id},{reload:!0})},function(e){n.open(e.data,!0)})})},e.unlockUser=function(){s.open("Вы действительно хотите разблокировать пользователя?").then(function(){o.unlockUser(e.user._id).then(function(){u.open("Пользователь разблокирован"),t.go("edit-user",{id:e.user._id},{reload:!0})},function(e){n.open(e.data,!0)})})},e.deleteUser=function(){s.open("Вы действительно хотите удалить пользователя?").then(function(){o.deleteUser(e.user._id).then(function(){u.open("Пользователь удален"),t.go("users-list")},function(e){n.open(e.data,!0)})})},e.removeAllUserDeliveryPoints=function(){s.open("Вы действительно хотите удалить все точки доставки пользователя?").then(function(){o.removeAllUserDeliveryPoints(e.user._id).then(function(){u.open("Все точки доствки пользователя удалены"),t.reload()},function(e){n.open(e.data,!0)})})}}]),angular.module("zakaz-xd.manage-users.users-list",["zakaz-xd.dialogs","zakaz-xd.directives.pagination","zakaz-xd.resources.users-resource","zakaz-xd.auth"]).controller("UsersListCtrl",["$scope","$stateParams","$state","UsersResource","ErrorDialog","InfoDialog",function(e,r,t,o,n){function u(r){o.getAllUsers(r).then(function(r){e.userList=r.data.items,e.pageConfig.count=r.data.count},function(e){n.open(e.data)})}e.userList=[],e.pageConfig={page:1,itemsPerPage:10,pageChanged:function(e,r){u({page:e,itemsPerPage:r})}},u({page:e.pageConfig.page,itemsPerPage:e.pageConfig.itemsPerPage})}]),angular.module("zakaz-xd.orders.all-orders-list",["zakaz-xd.dialogs","zakaz-xd.directives.pagination","zakaz-xd.resources.orders-resource","zakaz-xd.auth"]).controller("AllOrdersListCtrl",["$scope","$stateParams","$state","OrdersResource","ErrorDialog","InfoDialog","user",function(e,r,t,o,n,u,s){function a(r){o.getAllOrders(r).then(function(r){e.orderList=r.data.items,e.pageConfig.count=r.data.count},function(e){n.open(e.data)})}e.user=s,e.orderList=[],e.pageConfig={page:1,itemsPerPage:10,pageChanged:function(e,r){a({page:e,itemsPerPage:r})}},a({page:e.pageConfig.page,itemsPerPage:e.pageConfig.itemsPerPage})}]),angular.module("zakaz-xd.orders.edit-order",["zakaz-xd.dialogs","zakaz-xd.resources.orders-resource","zakaz-xd.auth"]).controller("EditOrderCtrl",["$scope","$stateParams","$state","OrdersResource","ErrorDialog","InfoDialog","YesNoDialog","order","user","author","AuthService",function(e,r,t,o,n,u,s,a,i,d,c){e.AuthService=c,e.isCreate=!a._id,e.order=a,e.user=i,e.author=d,e.save=function(r){return r?!1:(e.isCreate?o.createOrder(e.order).then(function(){u.open("Ваш заказ успешно создан"),t.go("user-orders-list")},function(e){n.open(e.data,!0)}):o.editOrder(e.order).then(function(){u.open("Заказ успешно изменен"),t.go("user-orders-list")},function(e){n.open(e.data,!0)}),void 0)},e.removeAllOrderProducts=function(){s.open("Вы действительно хотите удалить все продукты у заказа?").then(function(){o.removeAllOrderProducts(e.order._id).then(function(){u.open("Все продукты заказа удалены"),t.reload()},function(e){n.open(e.data,!0)})})},e.deleteOrder=function(){s.open("Вы действительно хотите удалить заказ?").then(function(){o.deleteOrder(e.order._id).then(function(){u.open("Заказ удален"),t.go("user-orders-list")},function(e){n.open(e.data,!0)})})},e.activate=function(){s.open("Вы действительно хотите активировать заказ?").then(function(){o.activateOrder(e.order._id).then(function(){u.open("Заказ активирован"),t.go("user-orders-list")},function(e){n.open(e.data,!0)})})},e.approve=function(){s.open("Вы действительно хотите подтвердить заказ?").then(function(){o.approveOrder(e.order._id).then(function(){u.open("Заказ подтвержден"),t.go("user-orders-list")},function(e){n.open(e.data,!0)})})},e.ship=function(){s.open("Вы действительно хотите перевести заказ в отгруженные?").then(function(){o.shipOrder(e.order._id).then(function(){u.open("Заказ переведен в отгруженные"),t.go("user-orders-list")},function(e){n.open(e.data,!0)})})},e.close=function(){s.open("Вы действительно хотите закрыть заказ?").then(function(){o.closeOrder(e.order._id).then(function(){u.open("Заказ закрыт"),t.go("user-orders-list")},function(e){n.open(e.data,!0)})})},e.addComment=function(r){o.addOrderComment(e.order._id,{text:r}).then(function(){u.open("Комментарий добавлен"),t.reload()},function(e){n.open(e.data,!0)})},e.removeComment=function(r){s.open("Удалить комментарий?").then(function(){o.removeOrderComment(e.order._id,r._id).then(function(){u.open("Комментарий удален"),t.reload()},function(e){n.open(e.data,!0)})})}}]),angular.module("zakaz-xd.orders.edit-order-product",["zakaz-xd.dialogs","zakaz-xd.resources.orders-resource","zakaz-xd.auth","ui.select","ngSanitize"]).controller("EditOrderProductCtrl",["$scope","$stateParams","$state","OrdersResource","ErrorDialog","InfoDialog","YesNoDialog","order","orderProduct","userProducts","AuthService",function(e,r,t,o,n,u,s,a,i,d,c){e.AuthService=c,e.isCreate=!i.product,e.orderProduct=i,e.order=a,e.products=[],angular.forEach(d,function(e){this.push(e.product)},e.products),e.save=function(r){return r?!1:(e.isCreate?o.addOrderProduct(e.order._id,e.orderProduct).then(function(){u.open("Продукт добавлен в заказ"),t.go("edit-order",{id:e.order._id})},function(e){n.open(e.data)}):o.updateOrderProduct(e.order._id,e.orderProduct).then(function(){u.open("Продукт заказа изменен"),t.go("edit-order",{id:e.order._id})},function(e){n.open(e.data)}),void 0)},e.delete=function(){s.open("Вы действительно хотите удалить товар из заказа?").then(function(){o.removeOrderProduct(e.order._id,e.orderProduct._id).then(function(){u.open("Продукт заказа удален"),t.go("edit-order",{id:e.order._id})},function(e){n.open(e.data)})})}}]),angular.module("zakaz-xd.orders.orders-list",["zakaz-xd.dialogs","zakaz-xd.directives.pagination","zakaz-xd.resources.orders-resource","zakaz-xd.auth"]).controller("OrdersListCtrl",["$scope","$stateParams","$state","OrdersResource","ErrorDialog","InfoDialog","user",function(e,r,t,o,n,u,s){function a(r){o.getAllUserOrders(r).then(function(r){e.orderList=r.data.items,e.pageConfig.count=r.data.count},function(e){n.open(e.data)})}e.user=s,e.orderList=[],e.pageConfig={page:1,itemsPerPage:10,pageChanged:function(e,r){a({page:e,itemsPerPage:r})}},a({page:e.pageConfig.page,itemsPerPage:e.pageConfig.itemsPerPage})}]),angular.module("zakaz-xd.products.edit-product",["zakaz-xd.dialogs","zakaz-xd.resources.products-resource","zakaz-xd.auth","ui.select","ngSanitize"]).controller("EditProductCtrl",["$scope","$stateParams","$state","ProductsResource","ErrorDialog","InfoDialog","YesNoDialog","product","user","allMeasureUnits","allProductTypes",function(e,r,t,o,n,u,s,a,i,d,c){e.isCreate=!a._id,e.product=a,e.allMeasureUnits=d,e.allProductTypes=c,e.save=function(r){return r?!1:(e.isCreate?o.createProduct(e.product).then(function(){u.open("Товар успешно создан"),t.go("products-list")},function(e){n.open(e.data)}):o.editProduct(e.product).then(function(){u.open("Товар успешно изменен"),t.go("products-list")},function(e){n.open(e.data)}),void 0)},e.deleteProduct=function(){s.open("Вы действительно хотите удалить продукт?").then(function(){o.deleteProduct(e.product._id).then(function(){u.open("Продукт удален"),t.go("products-list")},function(e){n.open(e.data,!0)})})}}]),angular.module("zakaz-xd.products.products-list",["zakaz-xd.dialogs","zakaz-xd.directives.pagination","zakaz-xd.resources.products-resource","zakaz-xd.auth"]).controller("ProductsListCtrl",["$scope","$stateParams","$state","ProductsResource","ErrorDialog","InfoDialog","user",function(e,r,t,o,n,u,s){function a(r){o.getAllProducts(r).then(function(r){e.productList=r.data.items,e.pageConfig.count=r.data.count},function(e){n.open(e.data)})}e.user=s,e.productList=[],e.pageConfig={page:1,itemsPerPage:10,pageChanged:function(e,r){a({page:e,itemsPerPage:r})}},a({page:e.pageConfig.page,itemsPerPage:e.pageConfig.itemsPerPage})}]),angular.module("zakaz-xd.user-products.edit-user-product",["zakaz-xd.dialogs","zakaz-xd.resources.user-products-resource","zakaz-xd.resources.user-product-prices-resource","zakaz-xd.resources.users-resource","zakaz-xd.auth","ui.select","ngSanitize"]).controller("EditUserProductCtrl",["$scope","$stateParams","$state","UserProductsResource","UsersResource","UserProductPricesResource","ErrorDialog","InfoDialog","YesNoDialog","userProduct",function(e,r,t,o,n,u,s,a,i,d){function c(r){u.getProductUserPricesByUserProductId(e.userProduct._id,r).then(function(r){e.userProductPrices=r.data.items,e.pageConfig.count=r.data.count},function(e){s.open(e.data)})}e.isCreate=!d._id,e.userProduct=d,n.getAllUsers().then(function(r){e.allUserList=r.data},function(e){s.open(e.data)}),e.isCreate||(e.userProductPrices=[],e.pageConfig={page:1,itemsPerPage:5,pageChanged:function(e,r){c({page:e,itemsPerPage:r})}},c({page:e.pageConfig.page,itemsPerPage:e.pageConfig.itemsPerPage})),e.save=function(r){return r?!1:(e.isCreate?o.createUserProduct(e.userProduct).then(function(){a.open("Связь товара с пользователем успешно создана"),t.go("product-users-list",{id:e.userProduct.product._id})},function(e){s.open(e.data)}):o.editUserProduct(e.userProduct).then(function(){a.open("Изменение связи товара с пользователем успешно"),t.go("product-users-list",{id:e.userProduct.product._id})},function(e){s.open(e.data)}),void 0)},e.delete=function(){i.open("Вы действительно хотите удалить связь продукта и пользователя?").then(function(){o.deleteUserProduct(e.userProduct._id).then(function(){a.open("Связь с пользователем удалена"),t.go("product-users-list",{id:e.userProduct.product._id})},function(e){s.open(e.data,!0)})})}}]),angular.module("zakaz-xd.user-product-prices.edit-user-product-price",["zakaz-xd.dialogs","zakaz-xd.resources.user-products-resource","zakaz-xd.resources.user-product-prices-resource","zakaz-xd.directives.datepicker","zakaz-xd.auth","ui.select","ngSanitize"]).controller("EditUserProductPriceCtrl",["$scope","$stateParams","$state","UserProductsResource","UserProductPricesResource","ErrorDialog","InfoDialog","YesNoDialog","userProductPrice",function(e,r,t,o,n,u,s,a,i){e.isCreate=!i._id,e.userProductPrice=i,e.save=function(r){return r?!1:(console.log("$scope.userProductPrice",e.userProductPrice),e.isCreate?n.createUserProductPrice(e.userProductPrice).then(function(){s.open("Цена на связь пользователь-торвар создана"),t.go("edit-user-product",{userProductId:e.userProductPrice.userProduct._id})},function(e){u.open(e.data)}):n.editUserProductPrice(e.userProductPrice).then(function(){s.open("Изменение цены для связи пользователь-товар успешно"),t.go("edit-user-product",{userProductId:e.userProductPrice.userProduct._id})},function(e){u.open(e.data)}),void 0)},e.delete=function(){a.open("Вы действительно хотите удалить цену на связь пользователь-товар?").then(function(){n.deleteUserProductPrice(e.userProductPrice._id).then(function(){s.open("Цена на связь пользователь-товар удалена"),t.go("edit-user-product",{userProductId:e.userProductPrice.userProduct._id})},function(e){u.open(e.data,!0)})})}}]),angular.module("zakaz-xd.user-products.product-users-list",["zakaz-xd.dialogs","zakaz-xd.directives.pagination","zakaz-xd.resources.user-products-resource","zakaz-xd.auth"]).controller("ProductUsersListCtrl",["$scope","$stateParams","$state","UserProductsResource","ErrorDialog","InfoDialog","product",function(e,r,t,o,n,u,s){function a(r){o.getProductUsersByProductId(e.product._id,r).then(function(r){e.items=r.data.items,e.pageConfig.count=r.data.count},function(e){n.open(e.data)})}e.product=s,e.items=[],e.pageConfig={page:1,itemsPerPage:10,pageChanged:function(e,r){a({page:e,itemsPerPage:r})}},a({page:e.pageConfig.page,itemsPerPage:e.pageConfig.itemsPerPage})}]),angular.module("zakaz-xd.user-profile.delivery-point",["zakaz-xd.dialogs","zakaz-xd.resources.users-resource","zakaz-xd.auth"]).controller("UserProfileDeliveryPointCtrl",["$scope","$stateParams","$state","UsersResource","ErrorDialog","InfoDialog","YesNoDialog","user","deliveryPoint","AuthService",function(e,r,t,o,n,u,s,a,i,d){e.isCreate=!i._id,e.user=a,e.deliveryPoint=i,e.save=function(r){return r?!1:(e.isCreate?o.addCurrentUserDeliveryPoint(e.deliveryPoint).then(function(){u.open("Точка доставки добавлена"),d.reloadCurrentUser(),t.go("user-profile")},function(e){n.open(e.data,!0)}):o.updateCurrentUserDeliveryPoint(e.deliveryPoint).then(function(){u.open("Изменение точки доставки успешно"),t.go("user-profile",{id:e.user._id})},function(e){n.open(e.data,!0)}),void 0)},e.delete=function(){s.open("Вы действительно хотите удалить точку доставки?").then(function(){o.removeCurrentUserDeliveryPoint(e.deliveryPoint._id).then(function(){u.open("Точка доставки удалена"),d.reloadCurrentUser(),t.go("user-profile")},function(e){n.open(e.data,!0)})})}}]),angular.module("zakaz-xd.manage-users.edit-user.change-password",["zakaz-xd.dialogs","zakaz-xd.resources.users-resource","zakaz-xd.resources.roles-resource","zakaz-xd.auth"]).controller("EditUserChangePasswordCtrl",["$scope","$stateParams","$state","UsersResource","ErrorDialog","InfoDialog","user",function(e,r,t,o,n,u,s){e.user=s,e.data={newPassword:null,repeatNewPassword:null},e.changePassword=function(r){if(r)return!1;if(e.data.newPassword!==e.data.repeatNewPassword)return n.open({message:"Пароли не совпадают"});var s={userId:e.user._id,newPassword:e.data.newPassword,repeatNewPassword:e.data.repeatNewPassword};o.changePassword(s).then(function(){u.open("Пароль пользователя успешно изменен","Изменение пароля"),t.go("users-list")},function(e){n.open(e,!0)})}}]),angular.module("zakaz-xd.manage-users.edit-user.delivery-point",["zakaz-xd.dialogs","zakaz-xd.resources.users-resource","zakaz-xd.auth"]).controller("EditUserDeliveryPointCtrl",["$scope","$stateParams","$state","UsersResource","ErrorDialog","InfoDialog","YesNoDialog","user","deliveryPoint",function(e,r,t,o,n,u,s,a,i){e.isCreate=!i._id,e.user=a,e.deliveryPoint=i,e.save=function(r){return r?!1:(e.isCreate?o.addUserDeliveryPoint(e.user._id,e.deliveryPoint).then(function(){u.open("Точка доставки добавлена"),t.go("edit-user",{id:e.user._id})},function(e){n.open(e.data,!0)}):o.updateUserDeliveryPoint(e.user._id,e.deliveryPoint).then(function(){u.open("Изменение точки доставки успешно"),t.go("edit-user",{id:e.user._id})},function(e){n.open(e.data,!0)}),void 0)},e.delete=function(){s.open("Вы действительно хотите удалить точку доставки?").then(function(){o.removeUserDeliveryPoint(e.user._id,e.deliveryPoint._id).then(function(){u.open("Точка доставки удалена"),t.go("edit-user",{id:e.user._id})},function(e){n.open(e.data,!0)})})}}]);
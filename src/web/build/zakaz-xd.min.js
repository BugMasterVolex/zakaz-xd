function AccessError(){var e=Error.apply(this,arguments);e.name=this.name="AccessError",this.stack=e.stack,this.message=e.message}angular.module("zakaz-xd.main",["ui.router","zakaz-xd.auth","zakaz-xd.dialogs","zakaz-xd.auth.login-form","zakaz-xd.user-profile","zakaz-xd.orders.orders-list","zakaz-xd.orders.edit-order","zakaz-xd.orders.states","zakaz-xd.products.states","zakaz-xd.manage-users.states","zakaz-xd.user-profile.states","zakaz-xd.demo.states"]).config(["$stateProvider","$urlRouterProvider","ACCESS",function(e,r){e.state("login",{url:"/login",controller:"LoginFormCtrl",templateUrl:"app/main-pages/auth/login-form/login-form.tpl.html",resolve:{isAuthenticated:function(e,r){return r.isAuthenticated()},canGo:function(e,r){return r?e.reject("User already login"):e.when(!0)}}}).state("logout-success",{url:"/logout-success",templateUrl:"app/main-pages/auth/logout-success/logout-success.tpl.html"}).state("access-denied",{url:"/access-denied",templateUrl:"app/main-pages/auth/access-denied/access-denied.tpl.html"}).state("not-authenticated",{url:"/not-authenticated",templateUrl:"app/main-pages/auth/not-authenticated/not-authenticated.tpl.html"}),r.otherwise("/orders-list")}]).controller("ZakazXdCtrl",["$rootScope","$scope","$location","AuthService",function(){}]).controller("ZakazXdHeaderCtrl",["$rootScope","$scope","$state","AuthService","ErrorDialog",function(e,r,t,o,n){r.logout=function(){o.logout().then(function(){t.go("logout-success")},function(e){n.open(e.data,!0)})},o.isAuthenticated().then(function(e){e&&o.getCurrentUser()}),r.currentUser=function(){return o.currentUser()},r.isLogin=function(){return o.isLogin()},r.AuthService=o}]),angular.module("zakaz-xd.auth.access",[]).constant("ACCESS",{MANAGE_USERS:1,CREATE_ORDER:2,VIEW_OWN_ORDERS:4,EDIT_OWN_ORDER:8,REMOVE_OWN_ORDER:16,VIEW_ALL_ORDER:32,EDIT_ANY_ORDER:64,REMOVE_ANY_ORDER:128,CHANGE_OWN_PASSWORD:256,CHANGE_OWN_ROLE_LIST:512,VIEW_ROLES:1024,MANAGE_PRODUCTS:2048,MANAGE_ORDERS:4096}),angular.module("zakaz-xd.auth",["ngCookies","zakaz-xd.auth.access","zakaz-xd.resources.auth-resource","zakaz-xd.dialogs"]).run(["$rootScope","$state","AuthService","ErrorDialog",function(e,r,t,o){e.$on("$stateChangeError",function(e,r,n,s,u,a){e.preventDefault(),a instanceof AccessError?t.accessDenied():a.data?o.open(a.data):console.error(a)})}]).factory("AuthInterceptor",["$q","$cookies","AuthService",function(e,r,t){return{responseError:function(r){return r.config&&r.config.ignoreAuthInterceptor?e.reject(r):(401===r.status&&t.notAuthenticated(),403===r.status&&t.accessDenied(),e.reject(r))}}}]).config(["$httpProvider",function(e){e.interceptors.push("AuthInterceptor")}]).provider("AuthService",function(){this.$get=["$injector","$q","ACCESS",function(e,r,t){function o(){if(i)return i;var t=r.defer();return e.get("AuthResource").getCurrentUser().then(function(e){u=e.data,t.resolve(u),i=null},function(e){t.reject(e),i=null}),i=t.promise}function n(){var t=r.defer();return e.get("AuthResource").isAuthenticated().then(function(e){a=e.data,t.resolve(a)},function(e){t.reject(e)}),t.promise}function s(e,r){for(var t=0;t<e.roles.length;t++)for(var o=e.roles[t],n=0;n<o.accesses.length;n++){var s=o.accesses[n].value;if(r&s)return!0}return!1}var u=null,a=null,i=null;return{checkAccess:function(e){if(u)return s(u,e)?r.when("Current user is allowed access "+e):r.reject(new AccessError("Current user is not allowed access "+e));var t=r.defer();return o().then(function(r){s(r,e)?t.resolve("Current user is allowed access "+e):t.reject(new AccessError("Current user is not allowed access "+e))},function(e){t.reject(e)}),t.promise},hasAccess:function(e){return u?s(u,e):!1},hasAccessByCodes:function(e){if(!u)return!1;var r=e.split(",");if(0===r.length)return!0;for(var o=null,n=0;n<r.length;n++){var a=r[n],i=t[a];null!==i&&void 0!==i&&(o?o|=i:o=i)}return null===o?!1:s(u,o)},notAuthenticated:function(){a=!1,e.get("$state").go("login")},accessDenied:function(){e.get("$state").go("access-denied")},getCurrentUser:function(){return u?r.when(u):o()},reloadCurrentUser:function(){return u=null,o()},currentUser:function(){return u},isAuthenticated:function(){return null!==a?r.when(a):n()},isLogin:function(){return a},login:function(t,n){var s=r.defer();return e.get("AuthResource").login(t,n).then(function(){a=!0,o().then(function(e){s.resolve(e)},function(e){s.reject(e)})},function(e){s.reject(e)}),s.promise},logout:function(){var t=r.defer();return e.get("AuthResource").logout().then(function(e){a=null,u=null,i=null,t.resolve(e)},function(e){t.reject(e)}),t.promise}}}]}),angular.module("zakaz-xd.dialogs",["ui.bootstrap"]).factory("ErrorDialog",["$q","$modal","$sce",function(e,r){return{open:function(e,t){r.open({animation:!0,backdrop:"static",size:"lg",templateUrl:"app/dialogs/error-dialog.tpl.html",resolve:{},controller:function(r,o){r.error=e,r.printStack=t,r.close=function(){o.close()}}})}}}]).factory("InfoDialog",["$q","$modal","$sce",function(e,r,t){return{open:function(e,o){r.open({animation:!0,backdrop:"static",size:"lg",templateUrl:"app/dialogs/info-dialog.tpl.html",resolve:{},controller:function(r,n){r.message=t.trustAsHtml(e),r.title=o,r.close=function(){n.close()}}})}}}]).factory("YesNoDialog",["$q","$modal","$sce",function(e,r,t){return{open:function(e,o){var n=r.open({animation:!0,backdrop:"static",size:"lg",templateUrl:"app/dialogs/yes-no-dialog.tpl.html",resolve:{},controller:function(r){r.message=t.trustAsHtml(e),r.title=o,r.close=function(){r.$dismiss("NO")},r.yes=function(){r.$close("YES")},r.no=function(){r.$dismiss("NO")}}});return n.result}}}]).factory("ErrorHandler",["ErrorDialog",function(e){return{handle:function(r){e.open(r.data,!0)}}}]),AccessError.prototype=Object.create(Error.prototype,{constructor:{value:AccessError,writable:!0,configurable:!0}}),angular.module("zakaz-xd.resources.auth-resource",[]).factory("AuthResource",["$q","$http",function(e,r){var t="/auth";return{changePassword:function(e,o){return r.post(t+"/change-password",{newPassword:e,repeatNewPassword:o})},saveUser:function(e){return r.post(t+"/save-user",{user:e})},getCurrentUser:function(){return r.get(t+"/current-user",{headers:{"If-Modified-Since":"0"}})},login:function(e,o){var n={ignoreAuthInterceptor:!0};return r.post(t+"/login",{username:e,password:o},n)},logout:function(){return r.post(t+"/logout",{})},isAuthenticated:function(){return r.get(t+"/is-authenticated")}}}]),angular.module("zakaz-xd.resources.orders-resource",[]).factory("OrdersResource",["$q","$http",function(e,r){var t="/orders";return{createOrder:function(e){return r.post(t+"/create-order",{order:e})},editOrder:function(e){return r.post(t+"/edit-order",{order:e})},editCurrentUserOrder:function(e){return r.post(t+"/edit-user-order",{order:e})},deleteOrder:function(e){return r.post(t+"/delete-order",{id:e})},deleteCurrentUserOrder:function(e){return r.post(t+"/delete-user-order",{id:e})},getAllOrders:function(e){return r.get(t+"/all-orders",{params:e})},getAllUserOrders:function(e){return r.get(t+"/user-orders",{params:e})},getOrderById:function(e){return r.get(t+"/order-by-id",{params:{orderId:e}})},getUserOrderById:function(e){return r.get(t+"/user-order-by-id",{params:{orderId:e}})},getAllOrderStatuses:function(){return r.get(t+"/all-order-statuses")}}}]),angular.module("zakaz-xd.resources.products-resource",[]).factory("ProductsResource",["$q","$http",function(e,r){var t="/products";return{createProduct:function(e){return r.post(t+"/create-product",{product:e})},editProduct:function(e){return r.post(t+"/edit-product",{product:e})},deleteProduct:function(e){return r.post(t+"/delete-product",{id:e})},getAllProducts:function(e){return r.get(t+"/all-products",{params:e})},getProductById:function(e){return r.get(t+"/product-by-id",{params:{id:e}})},getAllMeasureUnits:function(){return r.get(t+"/all-measure-units")},getAllProductTypes:function(){return r.get(t+"/all-product-types")}}}]),angular.module("zakaz-xd.resources.roles-resource",[]).factory("RolesResource",["$q","$http",function(e,r){var t="/roles";return{getAllRoles:function(){return r.get(t+"/all-roles")}}}]),angular.module("zakaz-xd.resources.user-product-prices-resource",[]).factory("UserProductPricesResource",["$q","$http",function(e,r){var t="/user-product-prices";return{getProductUserPricesByUserProductId:function(e,o){return r.get(t+"/user-product-prices-by-user-product-id",{params:{id:e,page:o.page,itemsPerPage:o.itemsPerPage}})},createUserProductPrice:function(e){return r.post(t+"/create-user-product-price",{userProductPrice:e})},deleteUserProductPrice:function(e){return r.post(t+"/delete-user-product-price",{id:e})},editUserProductPrice:function(e){return r.post(t+"/edit-user-product-price",{userProductPrice:e})},getUserProductPriceById:function(e){return r.get(t+"/user-product-price-by-id",{params:{id:e}})}}}]),angular.module("zakaz-xd.resources.user-products-resource",[]).factory("UserProductsResource",["$q","$http",function(e,r){var t="/user-products";return{getProductUsersByProductId:function(e,o){return r.get(t+"/product-users-by-product-id",{params:{id:e,page:o.page,itemsPerPage:o.itemsPerPage}})},createUserProduct:function(e){return r.post(t+"/create-user-product",{userProduct:e})},deleteUserProduct:function(e){return r.post(t+"/delete-user-product",{id:e})},editUserProduct:function(e){return r.post(t+"/edit-user-product",{userProduct:e})},getUserProductById:function(e){return r.get(t+"/user-product-by-id",{params:{id:e}})}}}]),angular.module("zakaz-xd.resources.users-resource",[]).factory("UsersResource",["$q","$http",function(e,r){var t="/users";return{createUser:function(e){return r.post(t+"/create-user",{user:e})},editUser:function(e){return r.post(t+"/edit-user",{user:e})},changePassword:function(e){return r.post(t+"/change-password",e)},deleteUser:function(e){return r.post(t+"/delete-user",{userId:e})},lockUser:function(e){return r.post(t+"/lock-user",{userId:e})},unlockUser:function(e){return r.post(t+"/unlock-user",{userId:e})},getAllUsers:function(e){return r.get(t+"/all-users",{params:e})},getUserById:function(e){return r.get(t+"/user-by-id",{params:{userId:e}})},addUserDeliveryPoint:function(e,o){return r.post(t+"/add-user-delivery-point",{userId:e,deliveryPoint:o})},updateUserDeliveryPoint:function(e,o){return r.post(t+"/update-user-delivery-point",{userId:e,deliveryPoint:o})},removeUserDeliveryPoint:function(e,o){return r.post(t+"/remove-user-delivery-point",{userId:e,deliveryPointId:o})},removeAllUserDeliveryPoints:function(e){return r.post(t+"/remove-all-user-delivery-points",{userId:e})},addCurrentUserDeliveryPoint:function(e){return r.post(t+"/add-current-user-delivery-point",{deliveryPoint:e})},updateCurrentUserDeliveryPoint:function(e){return r.post(t+"/update-current-user-delivery-point",{deliveryPoint:e})},removeCurrentUserDeliveryPoint:function(e){return r.post(t+"/remove-current-user-delivery-point",{deliveryPointId:e})}}}]),angular.module("zakaz-xd.directives.datepicker",["ui.bootstrap"]).directive("zDatepicker",function(){return{restrict:"E",scope:{options:"=",ngModel:"=",required:"=",name:"@"},templateUrl:"app/directives/datepicker/z-datepicker.tpl.html",controller:function(e){e.format=e.options.format||"dd.MM.yyyy",e.open=function(r){r.preventDefault(),r.stopPropagation(),e.opened=!0}}}}),angular.module("zakaz-xd.directives.decimal",["ui.bootstrap","ngSanitize"]).directive("lowercase",function(){return{restrict:"A",require:"ngModel",link:function(e,r,t,o){function n(e){return console.log("fromUser",e),(e||"").toUpperCase()}function s(e){return console.log("toUser",e),(e||"").toLowerCase()}o.$parsers.push(n),o.$formatters.push(s)}}}),angular.module("zakaz-xd.directives.my.ui.mask",[]).value("myUiMaskConfig",{maskDefinitions:{9:/\d/,A:/[a-zA-Z]/,"*":/[a-zA-Z0-9]/},clearOnBlur:!0}).directive("myUiMask",["myUiMaskConfig","$parse",function(e,r){"use strict";return{priority:100,require:"ngModel",restrict:"A",compile:function(){var t=e;return function(e,o,n,s){function u(e){return angular.isDefined(e)?(v(e),B?(l(),p(),!0):d()):d()}function a(e){angular.isDefined(e)&&(R=e,B&&A())}function i(e){return B?(O=h(e||""),N=g(O),s.$setValidity("mask",N),N&&O.length?m(O):void 0):e}function c(e){return B?(O=h(e||""),N=g(O),s.$viewValue=O.length?m(O):"",s.$setValidity("mask",N),""===O&&n.required&&s.$setValidity("required",!s.$error.required),N?O:void 0):e}function d(){return B=!1,f(),angular.isDefined(V)?o.attr("placeholder",V):o.removeAttr("placeholder"),angular.isDefined(q)?o.attr("maxlength",q):o.removeAttr("maxlength"),o.val(s.$modelValue),s.$viewValue=s.$modelValue,!1}function l(){O=M=h(s.$viewValue||""),I=b=m(O),N=g(O);var e=N&&O.length?I:"";n.maxlength&&o.attr("maxlength",2*D[D.length-1]),o.attr("placeholder",R),o.val(e),s.$viewValue=e}function p(){G||(o.bind("blur",k),o.bind("mousedown mouseup",U),o.bind("input keyup click focus",A),G=!0)}function f(){G&&(o.unbind("blur",k),o.unbind("mousedown",U),o.unbind("mouseup",U),o.unbind("input",A),o.unbind("keyup",A),o.unbind("click",A),o.unbind("focus",A),G=!1)}function g(e){return e.length?e.length>=S:!0}function h(e){var r="",t=_.slice();return e=e.toString(),angular.forEach(w,function(r){e=e.replace(r,"")}),angular.forEach(e.split(""),function(e){t.length&&t[0].test(e)&&(r+=e,t.shift())}),r}function m(e){var r="",t=D.slice();return angular.forEach(R.split(""),function(o,n){e.length&&n===t[0]?(r+=e.charAt(0)||"_",e=e.substr(1),t.shift()):r+=o}),r}function P(e){var r=n.placeholder;return"undefined"!=typeof r&&r[e]?r[e]:"_"}function z(){return R.replace(/[_]+/g,"_").replace(/([^_]+)([a-zA-Z0-9])([^_])/g,"$1$2_$3").split("_")}function v(e){var r=0;if(D=[],_=[],R="","string"==typeof e){S=0;var t=!1,o=0,n=e.split("");angular.forEach(n,function(e,n){W.maskDefinitions[e]?(D.push(r),R+=P(n-o),_.push(W.maskDefinitions[e]),r++,t||S++):"?"===e?(t=!0,o++):(R+=e,r++)})}D.push(D.slice().pop()+1),w=z(),B=D.length>1?!0:!1}function k(){W.clearOnBlur&&(T=0,L=0,N&&0!==O.length||(I="",o.val(""),e.$apply(function(){s.$setViewValue("")})))}function U(e){"mousedown"===e.type?o.bind("mouseout",y):o.unbind("mouseout",y)}function y(){L=E(this),o.unbind("mouseout",y)}function A(r){r=r||{};var t=r.which,n=r.type;if(16!==t&&91!==t){var u,a=o.val(),i=b,c=h(a),d=M,l=!1,p=C(this)||0,f=T||0,g=p-f,P=D[0],z=D[c.length]||D.slice().shift(),v=L||0,k=E(this)>0,U=v>0,y=a.length>i.length||v&&a.length>i.length-v,A=a.length<i.length||v&&a.length===i.length-v,_=t>=37&&40>=t&&r.shiftKey,R=37===t,w=8===t||"keyup"!==n&&A&&-1===g,S=46===t||"keyup"!==n&&A&&0===g&&!U,O=(R||w||"click"===n)&&p>P;if(L=E(this),!_&&(!k||"click"!==n&&"keyup"!==n)){if("input"===n&&A&&!U&&c===d){for(;w&&p>P&&!x(p);)p--;for(;S&&z>p&&-1===D.indexOf(p);)p++;var I=D.indexOf(p);c=c.substring(0,I)+c.substring(I+1),l=!0}for(u=m(c),b=u,M=c,o.val(u),l&&e.$apply(function(){s.$setViewValue(c)}),y&&P>=p&&(p=P+1),O&&p--,p=p>z?z:P>p?P:p;!x(p)&&p>P&&z>p;)p+=O?-1:1;(O&&z>p||y&&!x(f))&&p++,T=p,$(this,p)}}}function x(e){return D.indexOf(e)>-1}function C(e){if(!e)return 0;if(void 0!==e.selectionStart)return e.selectionStart;if(document.selection&&o.is(":focus")){e.focus();var r=document.selection.createRange();return r.moveStart("character",e.value?-e.value.length:0),r.text.length}return 0}function $(e,r){if(!e)return 0;if(0!==e.offsetWidth&&0!==e.offsetHeight)if(e.setSelectionRange)o.is(":focus")&&(e.focus(),e.setSelectionRange(r,r));else if(e.createTextRange){var t=e.createTextRange();t.collapse(!0),t.moveEnd("character",r),t.moveStart("character",r),t.select()}}function E(e){return e?void 0!==e.selectionStart?e.selectionEnd-e.selectionStart:document.selection?document.selection.createRange().text.length:0:0}var D,_,R,w,S,O,I,N,b,M,T,L,B=!1,G=!1,V=n.placeholder,q=n.maxlength,W={};n.uiOptions?(W=e.$eval("["+n.uiOptions+"]"),angular.isObject(W[0])&&(W=function(e,r){for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(void 0===r[t]?r[t]=angular.copy(e[t]):angular.extend(r[t],e[t]));return r}(t,W[0]))):W=t,n.$observe("hcsUiMask",u),n.$observe("placeholder",a);var j=!1;n.$observe("modelViewValue",function(e){"true"===e&&(j=!0)}),e.$watch(n.ngModel,function(t){if(j&&t){var o=r(n.ngModel);o.assign(e,s.$viewValue)}}),s.$formatters.push(i),s.$parsers.push(c),o.bind("mousedown mouseup",U),Array.prototype.indexOf||(Array.prototype.indexOf=function(e){if(null===this)throw new TypeError;var r=Object(this),t=r.length>>>0;if(0===t)return-1;var o=0;if(arguments.length>1&&(o=Number(arguments[1]),o!==o?o=0:0!==o&&1/0!==o&&o!==-1/0&&(o=(o>0||-1)*Math.floor(Math.abs(o)))),o>=t)return-1;for(var n=o>=0?o:Math.max(t-Math.abs(o),0);t>n;n++)if(n in r&&r[n]===e)return n;return-1})}}}}]),angular.module("zakaz-xd.directives.pagination",["ui.bootstrap"]).directive("zPagination",function(){return{restrict:"E",scope:{config:"=?",page:"=?"},templateUrl:"app/directives/pagination/z-pagination.tpl.html",controller:function(e){e.config.maxSize=e.config.maxSize||5}}}),angular.module("zakaz-xd.demo.states",["ui.router","zakaz-xd.auth","zakaz-xd.demo"]).config(["$stateProvider","$urlRouterProvider","ACCESS",function(e){e.state("demo",{url:"/demo",controller:"DemoCtrl",templateUrl:"app/main-pages/demo/demo.tpl.html",resolve:{}})}]),angular.module("zakaz-xd.demo",["zakaz-xd.directives.decimal","zakaz-xd.directives.my.ui.mask","ui.select","ngSanitize"]).controller("DemoCtrl",["$scope","$stateParams","$state",function(e){e.mask="99.99.9999",e.placeholder="__.__.____",e.models={lowercase1:""}}]),angular.module("zakaz-xd.manage-users.states",["ui.router","zakaz-xd.auth","zakaz-xd.dialogs","zakaz-xd.resources.users-resource","zakaz-xd.manage-users.users-list","zakaz-xd.manage-users.edit-user","zakaz-xd.manage-users.edit-user.change-password","zakaz-xd.manage-users.edit-user.delivery-point"]).config(["$stateProvider","$urlRouterProvider","ACCESS",function(e,r,t){e.state("users-list",{url:"/manage-users/users-list",controller:"UsersListCtrl",templateUrl:"app/main-pages/manage-users/users-list/users-list.tpl.html",resolve:{hasAccess:function(e,r){return r.checkAccess(t.MANAGE_USERS)}}}).state("edit-user",{url:"/manage-users/user/edit/:id",controller:"EditUserCtrl",templateUrl:"app/main-pages/manage-users/edit-user/edit-user.tpl.html",resolve:{hasAccess:function(e,r){return r.checkAccess(t.MANAGE_USERS)},user:function(e,r){return r.getUserById(e.id).then(function(e){return e.data})},allRoles:function(e,r){return r.getAllRoles().then(function(e){return e.data})}}}).state("create-user",{url:"/manage-users/user/create",controller:"EditUserCtrl",templateUrl:"app/main-pages/manage-users/edit-user/edit-user.tpl.html",resolve:{hasAccess:function(e,r){return r.checkAccess(t.MANAGE_USERS)},user:function(){return{}},allRoles:function(e,r){return r.getAllRoles().then(function(e){return e.data})}}}).state("change-user-password",{url:"/manage-users/user/change-password/:id",controller:"EditUserChangePasswordCtrl",templateUrl:"app/main-pages/manage-users/edit-user/change-password/edit-user-change-password.tpl.html",resolve:{hasAccess:function(e,r){return r.checkAccess(t.MANAGE_USERS)},user:function(e,r){return r.getUserById(e.id).then(function(e){return e.data})}}}).state("add-user-delivery-point",{url:"/manage-users/user/add-user-delivery-point/:id",controller:"EditUserDeliveryPointCtrl",templateUrl:"app/main-pages/manage-users/edit-user/delivery-point/edit-user-delivery-point.tpl.html",resolve:{hasAccess:function(e,r){return r.checkAccess(t.MANAGE_USERS)},deliveryPoint:function(){return{}},user:function(e,r){return r.getUserById(e.id).then(function(e){return e.data})}}}).state("edit-user-delivery-point",{url:"/manage-users/user/edit-user-delivery-point/:userId/:deliveryPointId",controller:"EditUserDeliveryPointCtrl",templateUrl:"app/main-pages/manage-users/edit-user/delivery-point/edit-user-delivery-point.tpl.html",resolve:{hasAccess:function(e,r){return r.checkAccess(t.MANAGE_USERS)},user:function(e,r){return r.getUserById(e.userId).then(function(e){return e.data})},deliveryPoint:function(e,r){for(var t=0;t<r.deliveryPoints.length;t++){var o=r.deliveryPoints[t];if(o._id===e.deliveryPointId)return o}return null}}})}]),angular.module("zakaz-xd.dialogs.",["ui.bootstrap"]).factory("ErrorDialog",["$q","$modal","$sce",function(e,r){return{open:function(e,t){r.open({animation:!0,backdrop:"static",size:"lg",templateUrl:"app/dialogs/error-dialog.tpl.html",resolve:{},controller:function(r,o){r.error=e,r.printStack=t,r.close=function(){o.close()}}})}}}]),angular.module("zakaz-xd.orders.states",["ui.router","zakaz-xd.auth","zakaz-xd.dialogs","zakaz-xd.resources.orders-resource","zakaz-xd.orders.orders-list","zakaz-xd.orders.edit-order"]).config(["$stateProvider","$urlRouterProvider","ACCESS",function(e,r,t){e.state("orders-list",{url:"/orders-list",controller:"OrdersListCtrl",templateUrl:"app/main-pages/orders/orders-list/orders-list.tpl.html",resolve:{user:function(e,r){return r.getCurrentUser()},hasAccess:function(e,r){return r.checkAccess(t.EDIT_OWN_ORDER)}}}).state("edit-order",{url:"/order/edit/:id",controller:"EditOrderCtrl",templateUrl:"app/main-pages/orders/edit-order/edit-order.tpl.html",resolve:{hasAccess:function(e,r){return r.checkAccess(t.EDIT_OWN_ORDER)},order:function(e,r){return r.getUserOrderById(e.id).then(function(e){return e.data})},allOrderStatuses:function(e,r){return r.getAllOrderStatuses().then(function(e){return e.data})},user:function(e,r){return r.getCurrentUser()}}}).state("create-order",{url:"/order/create",controller:"EditOrderCtrl",templateUrl:"app/main-pages/orders/edit-order/edit-order.tpl.html",resolve:{hasAccess:function(e,r){return r.checkAccess(t.EDIT_OWN_ORDER)},order:function(){return{}},allOrderStatuses:function(e,r){return r.getAllOrderStatuses().then(function(e){return e.data})},user:function(e,r){return r.getCurrentUser()}}})}]),angular.module("zakaz-xd.products.states",["ui.router","zakaz-xd.auth","zakaz-xd.dialogs","zakaz-xd.resources.products-resource","zakaz-xd.products.products-list","zakaz-xd.products.edit-product","zakaz-xd.user-products.states"]).config(["$stateProvider","$urlRouterProvider","ACCESS",function(e,r,t){e.state("products-list",{url:"/products-list",controller:"ProductsListCtrl",templateUrl:"app/main-pages/products/products-list/products-list.tpl.html",resolve:{user:function(e,r){return r.getCurrentUser()},hasAccess:function(e,r){return r.checkAccess(t.MANAGE_PRODUCTS)}}}).state("edit-product",{url:"/product/edit/:id",controller:"EditProductCtrl",templateUrl:"app/main-pages/products/edit-product/edit-product.tpl.html",resolve:{hasAccess:function(e,r){return r.checkAccess(t.MANAGE_PRODUCTS)},product:function(e,r){return r.getProductById(e.id).then(function(e){return e.data})},user:function(e,r){return r.getCurrentUser()},allMeasureUnits:function(e,r){return r.getAllMeasureUnits().then(function(e){return e.data})},allProductTypes:function(e,r){return r.getAllProductTypes().then(function(e){return e.data})}}}).state("create-product",{url:"/product/create",controller:"EditProductCtrl",templateUrl:"app/main-pages/products/edit-product/edit-product.tpl.html",resolve:{hasAccess:function(e,r){return r.checkAccess(t.MANAGE_PRODUCTS)},product:function(){return{}},user:function(e,r){return r.getCurrentUser()},allMeasureUnits:function(e,r){return r.getAllMeasureUnits().then(function(e){return e.data})},allProductTypes:function(e,r){return r.getAllProductTypes().then(function(e){return e.data})}}})}]),angular.module("zakaz-xd.user-products.states",["ui.router","zakaz-xd.auth","zakaz-xd.dialogs","zakaz-xd.resources.user-products-resource","zakaz-xd.resources.user-product-prices-resource","zakaz-xd.resources.products-resource","zakaz-xd.user-products.product-users-list","zakaz-xd.user-products.edit-user-product","zakaz-xd.user-product-prices.edit-user-product-price"]).config(["$stateProvider","$urlRouterProvider","ACCESS",function(e,r,t){e.state("product-users-list",{url:"/product-users-list/:id",controller:"ProductUsersListCtrl",templateUrl:"app/main-pages/user-products/product-users-list/product-users-list.tpl.html",resolve:{product:function(e,r){return r.getProductById(e.id).then(function(e){return e.data})},hasAccess:function(e,r){return r.checkAccess(t.MANAGE_PRODUCTS)}}}).state("create-user-product",{url:"/product/user-product/create/:productId",controller:"EditUserProductCtrl",templateUrl:"app/main-pages/user-products/edit-user-product/edit-user-product.tpl.html",resolve:{hasAccess:function(e,r){return r.checkAccess(t.MANAGE_PRODUCTS)},product:function(e,r){return r.getProductById(e.productId).then(function(e){return e.data})},userProduct:function(e){return{product:e}}}}).state("edit-user-product",{url:"/product/user-product/edit/:userProductId",controller:"EditUserProductCtrl",templateUrl:"app/main-pages/user-products/edit-user-product/edit-user-product.tpl.html",resolve:{hasAccess:function(e,r){return r.checkAccess(t.MANAGE_PRODUCTS)},userProduct:function(e,r){return r.getUserProductById(e.userProductId).then(function(e){return e.data})},product:function(e,r,t){return r.getProductById(t.product._id).then(function(e){return e.data})}}}).state("add-user-product-price",{url:"/product/user-product/add-user-product-price/:userProductId",controller:"EditUserProductPriceCtrl",templateUrl:"app/main-pages/user-products/edit-user-product-price/edit-user-product-price.tpl.html",resolve:{hasAccess:function(e,r){return r.checkAccess(t.MANAGE_PRODUCTS)},userProductPrice:function(e,r){return r.getUserProductById(e.userProductId).then(function(e){return{userProduct:e.data}})}}}).state("edit-user-product-price",{url:"/product/user-product/edit-user-product-price/:userProductPriceId",controller:"EditUserProductPriceCtrl",templateUrl:"app/main-pages/user-products/edit-user-product-price/edit-user-product-price.tpl.html",resolve:{hasAccess:function(e,r){return r.checkAccess(t.MANAGE_PRODUCTS)},userProductPrice:function(e,r){return r.getUserProductPriceById(e.userProductPriceId).then(function(e){return e.data})}}})}]),angular.module("zakaz-xd.user-profile.states",["ui.router","zakaz-xd.auth","zakaz-xd.dialogs","zakaz-xd.resources.users-resource"]).config(["$stateProvider","$urlRouterProvider","ACCESS",function(e,r,t){e.state("user-profile",{url:"/profile",controller:"UserProfileCtrl",templateUrl:"app/main-pages/user-profile/user-profile.tpl.html",resolve:{user:function(e,r){return r.getCurrentUser()}}}).state("user-profile-change-password",{url:"/profile/change-password",controller:"UserProfileCtrl",templateUrl:"app/main-pages/user-profile/user-profile-change-password.tpl.html",resolve:{user:function(e,r){return r.getCurrentUser()},hasAccess:function(e,r){return r.checkAccess(t.CHANGE_OWN_PASSWORD)}}}).state("user-profile-add-delivery-point",{url:"/profile/add-delivery-point",controller:"UserProfileDeliveryPointCtrl",templateUrl:"app/main-pages/user-profile/delivery-point/delivery-point.tpl.html",resolve:{hasAccess:function(e,r){return r.checkAccess(t.EDIT_OWN_ORDER)},deliveryPoint:function(){return{}},user:function(e,r){return r.getCurrentUser()}}}).state("user-profile-edit-delivery-point",{url:"/profile/edit-delivery-point/:deliveryPointId",controller:"UserProfileDeliveryPointCtrl",templateUrl:"app/main-pages/user-profile/delivery-point/delivery-point.tpl.html",resolve:{hasAccess:function(e,r){return r.checkAccess(t.EDIT_OWN_ORDER)},user:function(e,r){return r.getCurrentUser()},deliveryPoint:function(e,r){for(var t=0;t<r.deliveryPoints.length;t++){var o=r.deliveryPoints[t];if(o._id===e.deliveryPointId)return o}return null}}})}]),angular.module("zakaz-xd.user-profile",["zakaz-xd.dialogs","zakaz-xd.resources.auth-resource","zakaz-xd.auth","zakaz-xd.user-profile.states","zakaz-xd.user-profile.delivery-point"]).controller("UserProfileCtrl",["$scope","$stateParams","$state","$http","user","AuthResource","ErrorDialog","InfoDialog","AuthService",function(e,r,t,o,n,s,u,a,i){e.user=angular.copy(n),e.data={newPassword:null,repeatNewPassword:null},e.save=function(r){return r?!1:(s.saveUser(e.user).then(function(){i.reloadCurrentUser().then(function(r){e.user=angular.copy(r),a.open("Успешное сохранение изменений","Сохранение изменений")},function(e){u.open(e,!0)})},function(e){u.open(e,!0)}),void 0)},e.changePassword=function(r){return r?!1:e.data.newPassword!==e.data.repeatNewPassword?u.open({message:"Пароли не совпадают"}):(s.changePassword(e.data.newPassword,e.data.repeatNewPassword).then(function(){a.open('Ваш пароль успешно <span style="color: blue;"> изменен <span>',"Изменение пароля")},function(e){u.open(e,!0)}),void 0)}}]),angular.module("zakaz-xd.auth.login-form",["zakaz-xd.auth","zakaz-xd.dialogs"]).controller("LoginFormCtrl",["$scope","$stateParams","$state","AuthService","ErrorDialog",function(e,r,t,o,n){e.credentials={username:null,password:null,rememberMe:null},e.login=function(r){return r?!1:(o.login(e.credentials.username,e.credentials.password).then(function(){e.errorMsg=null,t.go("orders-list")},function(e){n.open(e.data)}),void 0)}}]),angular.module("zakaz-xd.manage-users.edit-user",["zakaz-xd.dialogs","zakaz-xd.resources.users-resource","zakaz-xd.resources.roles-resource","zakaz-xd.auth"]).controller("EditUserCtrl",["$scope","$stateParams","$state","UsersResource","ErrorDialog","InfoDialog","YesNoDialog","user","allRoles",function(e,r,t,o,n,s,u,a,i){function c(e,r){if(r.roles){for(var t={},o=0;o<e.length;o++){var n=e[o];t[n._id]=n}for(var s=0;s<r.roles.length;s++){var u=r.roles[s];t[u._id]&&(t[u._id].checked=!0)}}}function d(e,r){for(var t=[],o=0;o<e.length;o++){var n=e[o];n.checked&&t.push(n)}r.roles=t}e.isCreate=!a._id,e.allRoles=i,e.user=a,e.user.roles||(e.user.roles=[]),c(i,a),e.save=function(r){return r?!1:(d(e.allRoles,e.user),e.isCreate?o.createUser(e.user).then(function(){s.open("Пользователь успешно добавлен"),t.go("users-list")},function(e){n.open(e.data,!0)}):o.editUser(e.user).then(function(){s.open("Пользователь успешно сохранен"),t.go("users-list")},function(e){n.open(e.data,!0)}),void 0)},e.lockUser=function(){u.open("Вы действительно хотите заблокировать пользователя?").then(function(){o.lockUser(e.user._id).then(function(){s.open("Пользователь заблокирован"),t.go("edit-user",{id:e.user._id},{reload:!0})},function(e){n.open(e.data,!0)})})},e.unlockUser=function(){u.open("Вы действительно хотите разблокировать пользователя?").then(function(){o.unlockUser(e.user._id).then(function(){s.open("Пользователь разблокирован"),t.go("edit-user",{id:e.user._id},{reload:!0})},function(e){n.open(e.data,!0)})})},e.deleteUser=function(){u.open("Вы действительно хотите удалить пользователя?").then(function(){o.deleteUser(e.user._id).then(function(){s.open("Пользователь удален"),t.go("users-list")},function(e){n.open(e.data,!0)})})},e.removeAllUserDeliveryPoints=function(){u.open("Вы действительно хотите удалить все точки доставки пользователя?").then(function(){o.removeAllUserDeliveryPoints(e.user._id).then(function(){s.open("Все точки доствки пользователя удалены"),t.reload()},function(e){n.open(e.data,!0)})})}}]),angular.module("zakaz-xd.manage-users.users-list",["zakaz-xd.dialogs","zakaz-xd.directives.pagination","zakaz-xd.resources.users-resource","zakaz-xd.auth"]).controller("UsersListCtrl",["$scope","$stateParams","$state","UsersResource","ErrorDialog","InfoDialog",function(e,r,t,o,n){function s(r){o.getAllUsers(r).then(function(r){e.userList=r.data.items,e.pageConfig.count=r.data.count},function(e){n.open(e.data)})}e.userList=[],e.pageConfig={page:1,itemsPerPage:10,pageChanged:function(e,r){s({page:e,itemsPerPage:r})}},s({page:e.pageConfig.page,itemsPerPage:e.pageConfig.itemsPerPage})}]),angular.module("zakaz-xd.orders.edit-order",["zakaz-xd.dialogs","zakaz-xd.resources.orders-resource","zakaz-xd.auth"]).controller("EditOrderCtrl",["$scope","$stateParams","$state","OrdersResource","ErrorDialog","InfoDialog","YesNoDialog","order","user",function(e,r,t,o,n,s,u,a,i){e.isCreate=!a._id,e.order=a,e.user=i,e.save=function(r){return console.log(r),r?!1:(e.isCreate?o.createOrder(e.order).then(function(){s.open("Ваш заказ успешно создан"),t.go("orders-list")},function(e){n.open(e.data,!0)
}):o.editCurrentUserOrder(e.order).then(function(){s.open("Ваш заказ успешно изменен"),t.go("orders-list")},function(e){n.open(e.data,!0)}),void 0)},e.deleteOrder=function(){u.open("Вы действительно хотите удалить заказ?").then(function(){o.deleteCurrentUserOrder(e.order._id).then(function(){s.open("Заказ удален"),t.go("orders-list")},function(e){n.open(e.data,!0)})})}}]),angular.module("zakaz-xd.orders.orders-list",["zakaz-xd.dialogs","zakaz-xd.directives.pagination","zakaz-xd.resources.orders-resource","zakaz-xd.auth"]).controller("OrdersListCtrl",["$scope","$stateParams","$state","OrdersResource","ErrorDialog","InfoDialog","user",function(e,r,t,o,n,s,u){function a(r){o.getAllUserOrders(r).then(function(r){e.orderList=r.data.items,e.pageConfig.count=r.data.count},function(e){n.open(e.data)})}e.user=u,e.orderList=[],e.pageConfig={page:1,itemsPerPage:10,pageChanged:function(e,r){a({page:e,itemsPerPage:r})}},a({page:e.pageConfig.page,itemsPerPage:e.pageConfig.itemsPerPage})}]),angular.module("zakaz-xd.products.edit-product",["zakaz-xd.dialogs","zakaz-xd.resources.products-resource","zakaz-xd.auth","ui.select","ngSanitize"]).controller("EditProductCtrl",["$scope","$stateParams","$state","ProductsResource","ErrorDialog","InfoDialog","YesNoDialog","product","user","allMeasureUnits","allProductTypes",function(e,r,t,o,n,s,u,a,i,c,d){e.isCreate=!a._id,e.product=a,e.allMeasureUnits=c,e.allProductTypes=d,e.save=function(r){return r?!1:(e.isCreate?o.createProduct(e.product).then(function(){s.open("Товар успешно создан"),t.go("products-list")},function(e){n.open(e.data)}):o.editProduct(e.product).then(function(){s.open("Товар успешно изменен"),t.go("products-list")},function(e){n.open(e.data)}),void 0)},e.deleteProduct=function(){u.open("Вы действительно хотите удалить продукт?").then(function(){o.deleteProduct(e.product._id).then(function(){s.open("Продукт удален"),t.go("products-list")},function(e){n.open(e.data,!0)})})}}]),angular.module("zakaz-xd.products.products-list",["zakaz-xd.dialogs","zakaz-xd.directives.pagination","zakaz-xd.resources.products-resource","zakaz-xd.auth"]).controller("ProductsListCtrl",["$scope","$stateParams","$state","ProductsResource","ErrorDialog","InfoDialog","user",function(e,r,t,o,n,s,u){function a(r){o.getAllProducts(r).then(function(r){e.productList=r.data.items,e.pageConfig.count=r.data.count},function(e){n.open(e.data)})}e.user=u,e.productList=[],e.pageConfig={page:1,itemsPerPage:10,pageChanged:function(e,r){a({page:e,itemsPerPage:r})}},a({page:e.pageConfig.page,itemsPerPage:e.pageConfig.itemsPerPage})}]),angular.module("zakaz-xd.user-products.edit-user-product",["zakaz-xd.dialogs","zakaz-xd.resources.user-products-resource","zakaz-xd.resources.user-product-prices-resource","zakaz-xd.resources.users-resource","zakaz-xd.auth","ui.select","ngSanitize"]).controller("EditUserProductCtrl",["$scope","$stateParams","$state","UserProductsResource","UsersResource","UserProductPricesResource","ErrorDialog","InfoDialog","YesNoDialog","userProduct",function(e,r,t,o,n,s,u,a,i,c){function d(r){s.getProductUserPricesByUserProductId(e.userProduct._id,r).then(function(r){e.userProductPrices=r.data.items,e.pageConfig.count=r.data.count},function(e){u.open(e.data)})}e.isCreate=!c._id,e.userProduct=c,n.getAllUsers().then(function(r){e.allUserList=r.data},function(e){u.open(e.data)}),e.isCreate||(e.userProductPrices=[],e.pageConfig={page:1,itemsPerPage:5,pageChanged:function(e,r){d({page:e,itemsPerPage:r})}},d({page:e.pageConfig.page,itemsPerPage:e.pageConfig.itemsPerPage})),e.save=function(r){return r?!1:(e.isCreate?o.createUserProduct(e.userProduct).then(function(){a.open("Связь товара с пользователем успешно создана"),t.go("product-users-list",{id:e.userProduct.product._id})},function(e){u.open(e.data)}):o.editUserProduct(e.userProduct).then(function(){a.open("Изменение связи товара с пользователем успешно"),t.go("product-users-list",{id:e.userProduct.product._id})},function(e){u.open(e.data)}),void 0)},e.delete=function(){i.open("Вы действительно хотите удалить связь продукта и пользователя?").then(function(){o.deleteUserProduct(e.userProduct._id).then(function(){a.open("Связь с пользователем удалена"),t.go("product-users-list",{id:e.userProduct.product._id})},function(e){u.open(e.data,!0)})})}}]),angular.module("zakaz-xd.user-product-prices.edit-user-product-price",["zakaz-xd.dialogs","zakaz-xd.resources.user-products-resource","zakaz-xd.resources.user-product-prices-resource","zakaz-xd.directives.datepicker","zakaz-xd.auth","ui.select","ngSanitize"]).controller("EditUserProductPriceCtrl",["$scope","$stateParams","$state","UserProductsResource","UserProductPricesResource","ErrorDialog","InfoDialog","YesNoDialog","userProductPrice",function(e,r,t,o,n,s,u,a,i){e.isCreate=!i._id,e.userProductPrice=i,e.save=function(r){return r?!1:(console.log("$scope.userProductPrice",e.userProductPrice),e.isCreate?n.createUserProductPrice(e.userProductPrice).then(function(){u.open("Цена на связь пользователь-торвар создана"),t.go("edit-user-product",{userProductId:e.userProductPrice.userProduct._id})},function(e){s.open(e.data)}):n.editUserProductPrice(e.userProductPrice).then(function(){u.open("Изменение цены для связи пользователь-товар успешно"),t.go("edit-user-product",{userProductId:e.userProductPrice.userProduct._id})},function(e){s.open(e.data)}),void 0)},e.delete=function(){a.open("Вы действительно хотите удалить цену на связь пользователь-товар?").then(function(){n.deleteUserProductPrice(e.userProductPrice._id).then(function(){u.open("Цена на связь пользователь-товар удалена"),t.go("edit-user-product",{userProductId:e.userProductPrice.userProduct._id})},function(e){s.open(e.data,!0)})})}}]),angular.module("zakaz-xd.user-products.product-users-list",["zakaz-xd.dialogs","zakaz-xd.directives.pagination","zakaz-xd.resources.user-products-resource","zakaz-xd.auth"]).controller("ProductUsersListCtrl",["$scope","$stateParams","$state","UserProductsResource","ErrorDialog","InfoDialog","product",function(e,r,t,o,n,s,u){function a(r){o.getProductUsersByProductId(e.product._id,r).then(function(r){e.items=r.data.items,e.pageConfig.count=r.data.count},function(e){n.open(e.data)})}e.product=u,e.items=[],e.pageConfig={page:1,itemsPerPage:10,pageChanged:function(e,r){a({page:e,itemsPerPage:r})}},a({page:e.pageConfig.page,itemsPerPage:e.pageConfig.itemsPerPage})}]),angular.module("zakaz-xd.user-profile.delivery-point",["zakaz-xd.dialogs","zakaz-xd.resources.users-resource","zakaz-xd.auth"]).controller("UserProfileDeliveryPointCtrl",["$scope","$stateParams","$state","UsersResource","ErrorDialog","InfoDialog","YesNoDialog","user","deliveryPoint","AuthService",function(e,r,t,o,n,s,u,a,i,c){e.isCreate=!i._id,e.user=a,e.deliveryPoint=i,e.save=function(r){return r?!1:(e.isCreate?o.addCurrentUserDeliveryPoint(e.deliveryPoint).then(function(){s.open("Точка доставки добавлена"),c.reloadCurrentUser(),t.go("user-profile")},function(e){n.open(e.data,!0)}):o.updateCurrentUserDeliveryPoint(e.deliveryPoint).then(function(){s.open("Изменение точки доставки успешно"),t.go("user-profile",{id:e.user._id})},function(e){n.open(e.data,!0)}),void 0)},e.delete=function(){u.open("Вы действительно хотите удалить точку доставки?").then(function(){o.removeCurrentUserDeliveryPoint(e.deliveryPoint._id).then(function(){s.open("Точка доставки удалена"),c.reloadCurrentUser(),t.go("user-profile")},function(e){n.open(e.data,!0)})})}}]),angular.module("zakaz-xd.manage-users.edit-user.change-password",["zakaz-xd.dialogs","zakaz-xd.resources.users-resource","zakaz-xd.resources.roles-resource","zakaz-xd.auth"]).controller("EditUserChangePasswordCtrl",["$scope","$stateParams","$state","UsersResource","ErrorDialog","InfoDialog","user",function(e,r,t,o,n,s,u){e.user=u,e.data={newPassword:null,repeatNewPassword:null},e.changePassword=function(r){if(r)return!1;if(e.data.newPassword!==e.data.repeatNewPassword)return n.open({message:"Пароли не совпадают"});var u={userId:e.user._id,newPassword:e.data.newPassword,repeatNewPassword:e.data.repeatNewPassword};o.changePassword(u).then(function(){s.open("Пароль пользователя успешно изменен","Изменение пароля"),t.go("users-list")},function(e){n.open(e,!0)})}}]),angular.module("zakaz-xd.manage-users.edit-user.delivery-point",["zakaz-xd.dialogs","zakaz-xd.resources.users-resource","zakaz-xd.auth"]).controller("EditUserDeliveryPointCtrl",["$scope","$stateParams","$state","UsersResource","ErrorDialog","InfoDialog","YesNoDialog","user","deliveryPoint",function(e,r,t,o,n,s,u,a,i){e.isCreate=!i._id,e.user=a,e.deliveryPoint=i,e.save=function(r){return r?!1:(e.isCreate?o.addUserDeliveryPoint(e.user._id,e.deliveryPoint).then(function(){s.open("Точка доставки добавлена"),t.go("edit-user",{id:e.user._id})},function(e){n.open(e.data,!0)}):o.updateUserDeliveryPoint(e.user._id,e.deliveryPoint).then(function(){s.open("Изменение точки доставки успешно"),t.go("edit-user",{id:e.user._id})},function(e){n.open(e.data,!0)}),void 0)},e.delete=function(){u.open("Вы действительно хотите удалить точку доставки?").then(function(){o.removeUserDeliveryPoint(e.user._id,e.deliveryPoint._id).then(function(){s.open("Точка доставки удалена"),t.go("edit-user",{id:e.user._id})},function(e){n.open(e.data,!0)})})}}]);
function AccessError(){var e=Error.apply(this,arguments);e.name=this.name="AccessError",this.stack=e.stack,this.message=e.message}angular.module("zakaz-xd.main",["ui.router","zakaz-xd.auth","zakaz-xd.dialogs","zakaz-xd.auth.login-form","zakaz-xd.user-profile","zakaz-xd.orders.orders-list","zakaz-xd.orders.edit-order","zakaz-xd.orders.states","zakaz-xd.products.states","zakaz-xd.manage-users.states","zakaz-xd.user-profile.states","zakaz-xd.demo.states"]).config(["$stateProvider","$urlRouterProvider","ACCESS",function(e,r){e.state("login",{url:"/login",controller:"LoginFormCtrl",templateUrl:"app/main-pages/auth/login-form/login-form.tpl.html",resolve:{isAuthenticated:function(e,r){return r.isAuthenticated()},canGo:function(e,r){return r?e.reject("User already login"):e.when(!0)}}}).state("logout-success",{url:"/logout-success",templateUrl:"app/main-pages/auth/logout-success/logout-success.tpl.html"}).state("access-denied",{url:"/access-denied",templateUrl:"app/main-pages/auth/access-denied/access-denied.tpl.html"}).state("not-authenticated",{url:"/not-authenticated",templateUrl:"app/main-pages/auth/not-authenticated/not-authenticated.tpl.html"}),r.otherwise("/orders-list")}]).controller("ZakazXdCtrl",["$rootScope","$scope","$location","AuthService",function(){}]).controller("ZakazXdHeaderCtrl",["$rootScope","$scope","$state","AuthService","ErrorDialog",function(e,r,t,o,s){r.logout=function(){o.logout().then(function(){t.go("logout-success")},function(e){s.open(e.data,!0)})},o.isAuthenticated().then(function(e){e&&o.getCurrentUser()}),r.currentUser=function(){return o.currentUser()},r.isLogin=function(){return o.isLogin()},r.AuthService=o}]),angular.module("zakaz-xd.auth.access",[]).constant("ACCESS",{MANAGE_USERS:1,CREATE_ORDER:2,VIEW_OWN_ORDERS:4,EDIT_OWN_ORDER:8,REMOVE_OWN_ORDER:16,VIEW_ALL_ORDER:32,EDIT_ANY_ORDER:64,REMOVE_ANY_ORDER:128,CHANGE_OWN_PASSWORD:256,CHANGE_OWN_ROLE_LIST:512,VIEW_ROLES:1024,MANAGE_PRODUCTS:2048,MANAGE_ORDERS:4096}),angular.module("zakaz-xd.auth",["ngCookies","zakaz-xd.auth.access","zakaz-xd.resources.auth-resource","zakaz-xd.dialogs"]).run(["$rootScope","$state","AuthService","ErrorDialog",function(e,r,t,o){e.$on("$stateChangeError",function(e,r,s,n,u,a){e.preventDefault(),a instanceof AccessError?t.accessDenied():a.data?o.open(a.data):console.error(a)})}]).factory("AuthInterceptor",["$q","$cookies","AuthService",function(e,r,t){return{responseError:function(r){return r.config&&r.config.ignoreAuthInterceptor?e.reject(r):(401===r.status&&t.notAuthenticated(),403===r.status&&t.accessDenied(),e.reject(r))}}}]).config(["$httpProvider",function(e){e.interceptors.push("AuthInterceptor")}]).provider("AuthService",function(){this.$get=["$injector","$q","ACCESS",function(e,r,t){function o(){if(i)return i;var t=r.defer();return e.get("AuthResource").getCurrentUser().then(function(e){u=e.data,t.resolve(u),i=null},function(e){t.reject(e),i=null}),i=t.promise}function s(){var t=r.defer();return e.get("AuthResource").isAuthenticated().then(function(e){a=e.data,t.resolve(a)},function(e){t.reject(e)}),t.promise}function n(e,r){for(var t=0;t<e.roles.length;t++)for(var o=e.roles[t],s=0;s<o.accesses.length;s++){var n=o.accesses[s].value;if(r&n)return!0}return!1}var u=null,a=null,i=null;return{checkAccess:function(e){if(u)return n(u,e)?r.when("Current user is allowed access "+e):r.reject(new AccessError("Current user is not allowed access "+e));var t=r.defer();return o().then(function(r){n(r,e)?t.resolve("Current user is allowed access "+e):t.reject(new AccessError("Current user is not allowed access "+e))},function(e){t.reject(e)}),t.promise},hasAccess:function(e){return u?n(u,e):!1},hasAccessByCodes:function(e){if(!u)return!1;var r=e.split(",");if(0===r.length)return!0;for(var o=null,s=0;s<r.length;s++){var a=r[s],i=t[a];null!==i&&void 0!==i&&(o?o|=i:o=i)}return null===o?!1:n(u,o)},notAuthenticated:function(){a=!1,e.get("$state").go("login")},accessDenied:function(){e.get("$state").go("access-denied")},getCurrentUser:function(){return u?r.when(u):o()},reloadCurrentUser:function(){return o()},currentUser:function(){return u},isAuthenticated:function(){return null!==a?r.when(a):s()},isLogin:function(){return a},login:function(t,s){var n=r.defer();return e.get("AuthResource").login(t,s).then(function(){a=!0,o().then(function(e){n.resolve(e)},function(e){n.reject(e)})},function(e){n.reject(e)}),n.promise},logout:function(){var t=r.defer();return e.get("AuthResource").logout().then(function(e){a=null,u=null,i=null,t.resolve(e)},function(e){t.reject(e)}),t.promise}}}]}),angular.module("zakaz-xd.dialogs",["ui.bootstrap"]).factory("ErrorDialog",["$q","$modal","$sce",function(e,r){return{open:function(e,t){r.open({animation:!0,backdrop:"static",size:"lg",templateUrl:"app/dialogs/error-dialog.tpl.html",resolve:{},controller:function(r,o){r.error=e,r.printStack=t,r.close=function(){o.close()}}})}}}]).factory("InfoDialog",["$q","$modal","$sce",function(e,r,t){return{open:function(e,o){r.open({animation:!0,backdrop:"static",size:"lg",templateUrl:"app/dialogs/info-dialog.tpl.html",resolve:{},controller:function(r,s){r.message=t.trustAsHtml(e),r.title=o,r.close=function(){s.close()}}})}}}]).factory("YesNoDialog",["$q","$modal","$sce",function(e,r,t){return{open:function(e,o){var s=r.open({animation:!0,backdrop:"static",size:"lg",templateUrl:"app/dialogs/yes-no-dialog.tpl.html",resolve:{},controller:function(r){r.message=t.trustAsHtml(e),r.title=o,r.close=function(){r.$dismiss("NO")},r.yes=function(){r.$close("YES")},r.no=function(){r.$dismiss("NO")}}});return s.result}}}]).factory("ErrorHandler",["ErrorDialog",function(e){return{handle:function(r){e.open(r.data,!0)}}}]),AccessError.prototype=Object.create(Error.prototype,{constructor:{value:AccessError,writable:!0,configurable:!0}}),angular.module("zakaz-xd.resources.auth-resource",[]).factory("AuthResource",["$q","$http",function(e,r){var t="/auth";return{changePassword:function(e,o){return r.post(t+"/change-password",{newPassword:e,repeatNewPassword:o})},saveUser:function(e){return r.post(t+"/save-user",{user:e})},getCurrentUser:function(){return r.get(t+"/current-user",{headers:{"If-Modified-Since":"0"}})},login:function(e,o){var s={ignoreAuthInterceptor:!0};return r.post(t+"/login",{username:e,password:o},s)},logout:function(){return r.post(t+"/logout",{})},isAuthenticated:function(){return r.get(t+"/is-authenticated")}}}]),angular.module("zakaz-xd.resources.orders-resource",[]).factory("OrdersResource",["$q","$http",function(e,r){var t="/orders";return{createOrder:function(e){return r.post(t+"/create-order",{order:e})},editOrder:function(e){return r.post(t+"/edit-order",{order:e})},deleteOrder:function(e){return r.post(t+"/delete-order",{orderId:e})},getAllOrders:function(e){return r.get(t+"/all-orders",{params:e})},getAllUserOrders:function(e){return r.get(t+"/user-orders",{params:e})},getOrderById:function(e){return r.get(t+"/order-by-id",{params:{orderId:e}})},getUserOrderById:function(e){return r.get(t+"/user-order-by-id",{params:{orderId:e}})},getAllOrderStatuses:function(){return r.get(t+"/all-order-statuses")}}}]),angular.module("zakaz-xd.resources.products-resource",[]).factory("ProductsResource",["$q","$http",function(e,r){var t="/products";return{createProduct:function(e){return r.post(t+"/create-product",{product:e})},editProduct:function(e){return r.post(t+"/edit-product",{product:e})},deleteProduct:function(e){return r.post(t+"/delete-product",{id:e})},getAllProducts:function(e){return r.get(t+"/all-products",{params:e})},getProductById:function(e){return r.get(t+"/product-by-id",{params:{id:e}})},getAllMeasureUnits:function(){return r.get(t+"/all-measure-units")},getAllProductTypes:function(){return r.get(t+"/all-product-types")}}}]),angular.module("zakaz-xd.resources.roles-resource",[]).factory("RolesResource",["$q","$http",function(e,r){var t="/roles";return{getAllRoles:function(){return r.get(t+"/all-roles")}}}]),angular.module("zakaz-xd.resources.user-product-prices-resource",[]).factory("UserProductPricesResource",["$q","$http",function(e,r){var t="/user-product-prices";return{getProductUserPricesByUserProductId:function(e,o){return r.get(t+"/user-product-prices-by-user-product-id",{params:{id:e,page:o.page,itemsPerPage:o.itemsPerPage}})},createUserProductPrice:function(e){return r.post(t+"/create-user-product-price",{userProductPrice:e})},deleteUserProductPrice:function(e){return r.post(t+"/delete-user-product-price",{id:e})},editUserProductPrice:function(e){return r.post(t+"/edit-user-product-price",{userProductPrice:e})},getUserProductPriceById:function(e){return r.get(t+"/user-product-price-by-id",{params:{id:e}})}}}]),angular.module("zakaz-xd.resources.user-products-resource",[]).factory("UserProductsResource",["$q","$http",function(e,r){var t="/user-products";return{getProductUsersByProductId:function(e,o){return r.get(t+"/product-users-by-product-id",{params:{id:e,page:o.page,itemsPerPage:o.itemsPerPage}})},createUserProduct:function(e){return r.post(t+"/create-user-product",{userProduct:e})},deleteUserProduct:function(e){return r.post(t+"/delete-user-product",{id:e})},editUserProduct:function(e){return r.post(t+"/edit-user-product",{userProduct:e})},getUserProductById:function(e){return r.get(t+"/user-product-by-id",{params:{id:e}})}}}]),angular.module("zakaz-xd.resources.users-resource",[]).factory("UsersResource",["$q","$http",function(e,r){var t="/users";return{createUser:function(e){return r.post(t+"/create-user",{user:e})},editUser:function(e){return r.post(t+"/edit-user",{user:e})},changePassword:function(e){return r.post(t+"/change-password",e)},deleteUser:function(e){return r.post(t+"/delete-user",{userId:e})},lockUser:function(e){return r.post(t+"/lock-user",{userId:e})},unlockUser:function(e){return r.post(t+"/unlock-user",{userId:e})},getAllUsers:function(e){return r.get(t+"/all-users",{params:e})},getUserById:function(e){return r.get(t+"/user-by-id",{params:{userId:e}})},addUserDeliveryPoint:function(e,o){return r.post(t+"/add-user-delivery-point",{userId:e,deliveryPoint:o})},updateUserDeliveryPoint:function(e,o){return r.post(t+"/update-user-delivery-point",{userId:e,deliveryPoint:o})},removeUserDeliveryPoint:function(e,o){return r.post(t+"/remove-user-delivery-point",{userId:e,deliveryPointId:o})},removeAllUserDeliveryPoints:function(e){return r.post(t+"/remove-all-user-delivery-points",{userId:e})},addCurrentUserDeliveryPoint:function(e){return r.post(t+"/add-current-user-delivery-point",{deliveryPoint:e})},updateCurrentUserDeliveryPoint:function(e){return r.post(t+"/update-current-user-delivery-point",{deliveryPoint:e})},removeCurrentUserDeliveryPoint:function(e){return r.post(t+"/remove-current-user-delivery-point",{deliveryPointId:e})}}}]),angular.module("zakaz-xd.directives.datepicker",["ui.bootstrap"]).directive("zDatepicker",function(){return{restrict:"E",scope:{options:"=",ngModel:"=",required:"=",name:"@"},templateUrl:"app/directives/datepicker/z-datepicker.tpl.html",controller:function(e){e.format=e.options.format||"dd.MM.yyyy",e.open=function(r){r.preventDefault(),r.stopPropagation(),e.opened=!0}}}}),angular.module("zakaz-xd.directives.decimal",["ui.bootstrap","ngSanitize"]).directive("lowercase",function(){return{restrict:"A",require:"ngModel",link:function(e,r,t,o){function s(e){return console.log("fromUser",e),(e||"").toUpperCase()}function n(e){return console.log("toUser",e),(e||"").toLowerCase()}o.$parsers.push(s),o.$formatters.push(n)}}}),angular.module("zakaz-xd.directives.pagination",["ui.bootstrap"]).directive("zPagination",function(){return{restrict:"E",scope:{config:"=?",page:"=?"},templateUrl:"app/directives/pagination/z-pagination.tpl.html",controller:function(e){e.config.maxSize=e.config.maxSize||5}}}),angular.module("zakaz-xd.demo.states",["ui.router","zakaz-xd.auth","zakaz-xd.demo"]).config(["$stateProvider","$urlRouterProvider","ACCESS",function(e){e.state("demo",{url:"/demo",controller:"DemoCtrl",templateUrl:"app/main-pages/demo/demo.tpl.html",resolve:{}})}]),angular.module("zakaz-xd.demo",["zakaz-xd.directives.decimal","ui.select","ngSanitize"]).controller("DemoCtrl",["$scope","$stateParams","$state",function(e){e.models={lowercase1:"testTEST"}}]),angular.module("zakaz-xd.manage-users.states",["ui.router","zakaz-xd.auth","zakaz-xd.dialogs","zakaz-xd.resources.users-resource","zakaz-xd.manage-users.users-list","zakaz-xd.manage-users.edit-user","zakaz-xd.manage-users.edit-user.change-password","zakaz-xd.manage-users.edit-user.delivery-point"]).config(["$stateProvider","$urlRouterProvider","ACCESS",function(e,r,t){e.state("users-list",{url:"/manage-users/users-list",controller:"UsersListCtrl",templateUrl:"app/main-pages/manage-users/users-list/users-list.tpl.html",resolve:{hasAccess:function(e,r){return r.checkAccess(t.MANAGE_USERS)}}}).state("edit-user",{url:"/manage-users/user/edit/:id",controller:"EditUserCtrl",templateUrl:"app/main-pages/manage-users/edit-user/edit-user.tpl.html",resolve:{hasAccess:function(e,r){return r.checkAccess(t.MANAGE_USERS)},user:function(e,r){return r.getUserById(e.id).then(function(e){return e.data})},allRoles:function(e,r){return r.getAllRoles().then(function(e){return e.data})}}}).state("create-user",{url:"/manage-users/user/create",controller:"EditUserCtrl",templateUrl:"app/main-pages/manage-users/edit-user/edit-user.tpl.html",resolve:{hasAccess:function(e,r){return r.checkAccess(t.MANAGE_USERS)},user:function(){return{}},allRoles:function(e,r){return r.getAllRoles().then(function(e){return e.data})}}}).state("change-user-password",{url:"/manage-users/user/change-password/:id",controller:"EditUserChangePasswordCtrl",templateUrl:"app/main-pages/manage-users/edit-user/change-password/edit-user-change-password.tpl.html",resolve:{hasAccess:function(e,r){return r.checkAccess(t.MANAGE_USERS)},user:function(e,r){return r.getUserById(e.id).then(function(e){return e.data})}}}).state("add-user-delivery-point",{url:"/manage-users/user/add-user-delivery-point/:id",controller:"EditUserDeliveryPointCtrl",templateUrl:"app/main-pages/manage-users/edit-user/delivery-point/edit-user-delivery-point.tpl.html",resolve:{hasAccess:function(e,r){return r.checkAccess(t.MANAGE_USERS)},deliveryPoint:function(){return{}},user:function(e,r){return r.getUserById(e.id).then(function(e){return e.data})}}}).state("edit-user-delivery-point",{url:"/manage-users/user/edit-user-delivery-point/:userId/:deliveryPointId",controller:"EditUserDeliveryPointCtrl",templateUrl:"app/main-pages/manage-users/edit-user/delivery-point/edit-user-delivery-point.tpl.html",resolve:{hasAccess:function(e,r){return r.checkAccess(t.MANAGE_USERS)},user:function(e,r){return r.getUserById(e.userId).then(function(e){return e.data})},deliveryPoint:function(e,r){for(var t=0;t<r.deliveryPoints.length;t++){var o=r.deliveryPoints[t];if(o._id===e.deliveryPointId)return o}return null}}})}]),angular.module("zakaz-xd.orders.states",["ui.router","zakaz-xd.auth","zakaz-xd.dialogs","zakaz-xd.resources.orders-resource","zakaz-xd.orders.orders-list","zakaz-xd.orders.edit-order"]).config(["$stateProvider","$urlRouterProvider","ACCESS",function(e,r,t){e.state("orders-list",{url:"/orders-list",controller:"OrdersListCtrl",templateUrl:"app/main-pages/orders/orders-list/orders-list.tpl.html",resolve:{user:function(e,r){return r.getCurrentUser()},hasAccess:function(e,r){return r.checkAccess(t.VIEW_OWN_ORDERS)}}}).state("edit-order",{url:"/order/edit/:id",controller:"EditOrderCtrl",templateUrl:"app/main-pages/orders/edit-order/edit-order.tpl.html",resolve:{hasAccess:function(e,r){return r.checkAccess(t.EDIT_OWN_ORDER)},order:function(e,r){return r.getOrderById(e.id).then(function(e){return e.data})},allOrderStatuses:function(e,r){return r.getAllOrderStatuses().then(function(e){return e.data})},user:function(e,r){return r.getCurrentUser()}}}).state("create-order",{url:"/order/create",controller:"EditOrderCtrl",templateUrl:"app/main-pages/orders/edit-order/edit-order.tpl.html",resolve:{hasAccess:function(e,r){return r.checkAccess(t.CREATE_ORDER)},order:function(){return{}},allOrderStatuses:function(e,r){return r.getAllOrderStatuses().then(function(e){return e.data})},user:function(e,r){return r.getCurrentUser()}}})}]),angular.module("zakaz-xd.products.states",["ui.router","zakaz-xd.auth","zakaz-xd.dialogs","zakaz-xd.resources.products-resource","zakaz-xd.products.products-list","zakaz-xd.products.edit-product","zakaz-xd.user-products.states"]).config(["$stateProvider","$urlRouterProvider","ACCESS",function(e,r,t){e.state("products-list",{url:"/products-list",controller:"ProductsListCtrl",templateUrl:"app/main-pages/products/products-list/products-list.tpl.html",resolve:{user:function(e,r){return r.getCurrentUser()},hasAccess:function(e,r){return r.checkAccess(t.MANAGE_PRODUCTS)}}}).state("edit-product",{url:"/product/edit/:id",controller:"EditProductCtrl",templateUrl:"app/main-pages/products/edit-product/edit-product.tpl.html",resolve:{hasAccess:function(e,r){return r.checkAccess(t.MANAGE_PRODUCTS)},product:function(e,r){return r.getProductById(e.id).then(function(e){return e.data})},user:function(e,r){return r.getCurrentUser()},allMeasureUnits:function(e,r){return r.getAllMeasureUnits().then(function(e){return e.data})},allProductTypes:function(e,r){return r.getAllProductTypes().then(function(e){return e.data})}}}).state("create-product",{url:"/product/create",controller:"EditProductCtrl",templateUrl:"app/main-pages/products/edit-product/edit-product.tpl.html",resolve:{hasAccess:function(e,r){return r.checkAccess(t.MANAGE_PRODUCTS)},product:function(){return{}},user:function(e,r){return r.getCurrentUser()},allMeasureUnits:function(e,r){return r.getAllMeasureUnits().then(function(e){return e.data})},allProductTypes:function(e,r){return r.getAllProductTypes().then(function(e){return e.data})}}})}]),angular.module("zakaz-xd.user-products.states",["ui.router","zakaz-xd.auth","zakaz-xd.dialogs","zakaz-xd.resources.user-products-resource","zakaz-xd.resources.user-product-prices-resource","zakaz-xd.resources.products-resource","zakaz-xd.user-products.product-users-list","zakaz-xd.user-products.edit-user-product","zakaz-xd.user-product-prices.edit-user-product-price"]).config(["$stateProvider","$urlRouterProvider","ACCESS",function(e,r,t){e.state("product-users-list",{url:"/product-users-list/:id",controller:"ProductUsersListCtrl",templateUrl:"app/main-pages/user-products/product-users-list/product-users-list.tpl.html",resolve:{product:function(e,r){return r.getProductById(e.id).then(function(e){return e.data})},hasAccess:function(e,r){return r.checkAccess(t.MANAGE_PRODUCTS)}}}).state("create-user-product",{url:"/product/user-product/create/:productId",controller:"EditUserProductCtrl",templateUrl:"app/main-pages/user-products/edit-user-product/edit-user-product.tpl.html",resolve:{hasAccess:function(e,r){return r.checkAccess(t.MANAGE_PRODUCTS)},product:function(e,r){return r.getProductById(e.productId).then(function(e){return e.data})},userProduct:function(e){return{product:e}}}}).state("edit-user-product",{url:"/product/user-product/edit/:userProductId",controller:"EditUserProductCtrl",templateUrl:"app/main-pages/user-products/edit-user-product/edit-user-product.tpl.html",resolve:{hasAccess:function(e,r){return r.checkAccess(t.MANAGE_PRODUCTS)},userProduct:function(e,r){return r.getUserProductById(e.userProductId).then(function(e){return e.data})},product:function(e,r,t){return r.getProductById(t.product._id).then(function(e){return e.data})}}}).state("add-user-product-price",{url:"/product/user-product/add-user-product-price/:userProductId",controller:"EditUserProductPriceCtrl",templateUrl:"app/main-pages/user-products/edit-user-product-price/edit-user-product-price.tpl.html",resolve:{hasAccess:function(e,r){return r.checkAccess(t.MANAGE_PRODUCTS)},userProductPrice:function(e,r){return r.getUserProductById(e.userProductId).then(function(e){return{userProduct:e.data}})}}}).state("edit-user-product-price",{url:"/product/user-product/edit-user-product-price/:userProductPriceId",controller:"EditUserProductPriceCtrl",templateUrl:"app/main-pages/user-products/edit-user-product-price/edit-user-product-price.tpl.html",resolve:{hasAccess:function(e,r){return r.checkAccess(t.MANAGE_PRODUCTS)},userProductPrice:function(e,r){return r.getUserProductPriceById(e.userProductPriceId).then(function(e){return e.data})}}})}]),angular.module("zakaz-xd.user-profile.states",["ui.router","zakaz-xd.auth","zakaz-xd.dialogs","zakaz-xd.resources.users-resource"]).config(["$stateProvider","$urlRouterProvider","ACCESS",function(e,r,t){e.state("user-profile",{url:"/profile",controller:"UserProfileCtrl",templateUrl:"app/main-pages/user-profile/user-profile.tpl.html",resolve:{user:function(e,r){return r.getCurrentUser()}}}).state("user-profile-change-password",{url:"/profile/change-password",controller:"UserProfileCtrl",templateUrl:"app/main-pages/user-profile/user-profile-change-password.tpl.html",resolve:{user:function(e,r){return r.getCurrentUser()},hasAccess:function(e,r){return r.checkAccess(t.CHANGE_OWN_PASSWORD)}}}).state("user-profile-add-delivery-point",{url:"/profile/add-delivery-point",controller:"UserProfileDeliveryPointCtrl",templateUrl:"app/main-pages/user-profile/delivery-point/delivery-point.tpl.html",resolve:{hasAccess:function(e,r){return r.checkAccess(t.EDIT_OWN_ORDER)},deliveryPoint:function(){return{}},user:function(e,r){return r.getCurrentUser()}}}).state("user-profile-edit-delivery-point",{url:"/profile/edit-delivery-point/:deliveryPointId",controller:"UserProfileDeliveryPointCtrl",templateUrl:"app/main-pages/user-profile/delivery-point/delivery-point.tpl.html",resolve:{hasAccess:function(e,r){return r.checkAccess(t.EDIT_OWN_ORDER)},user:function(e,r){return r.getCurrentUser()},deliveryPoint:function(e,r){for(var t=0;t<r.deliveryPoints.length;t++){var o=r.deliveryPoints[t];if(o._id===e.deliveryPointId)return o}return null}}})}]),angular.module("zakaz-xd.user-profile",["zakaz-xd.dialogs","zakaz-xd.resources.auth-resource","zakaz-xd.auth","zakaz-xd.user-profile.states"]).controller("UserProfileCtrl",["$scope","$stateParams","$state","$http","user","AuthResource","ErrorDialog","InfoDialog","AuthService",function(e,r,t,o,s,n,u,a,i){e.user=angular.copy(s),e.data={newPassword:null,repeatNewPassword:null},e.save=function(r){return r?!1:(n.saveUser(e.user).then(function(){i.reloadCurrentUser().then(function(r){e.user=angular.copy(r),a.open("Успешное сохранение изменений","Сохранение изменений")},function(e){u.open(e,!0)})},function(e){u.open(e,!0)}),void 0)},e.changePassword=function(r){return r?!1:e.data.newPassword!==e.data.repeatNewPassword?u.open({message:"Пароли не совпадают"}):(n.changePassword(e.data.newPassword,e.data.repeatNewPassword).then(function(){a.open('Ваш пароль успешно <span style="color: blue;"> изменен <span>',"Изменение пароля")},function(e){u.open(e,!0)}),void 0)}}]),angular.module("zakaz-xd.auth.login-form",["zakaz-xd.auth","zakaz-xd.dialogs"]).controller("LoginFormCtrl",["$scope","$stateParams","$state","AuthService","ErrorDialog",function(e,r,t,o,s){e.credentials={username:null,password:null,rememberMe:null},e.login=function(r){return r?!1:(o.login(e.credentials.username,e.credentials.password).then(function(){e.errorMsg=null,t.go("orders-list")},function(e){s.open(e.data)}),void 0)}}]),angular.module("zakaz-xd.manage-users.edit-user",["zakaz-xd.dialogs","zakaz-xd.resources.users-resource","zakaz-xd.resources.roles-resource","zakaz-xd.auth"]).controller("EditUserCtrl",["$scope","$stateParams","$state","UsersResource","ErrorDialog","InfoDialog","YesNoDialog","user","allRoles",function(e,r,t,o,s,n,u,a,i){function c(e,r){if(r.roles){for(var t={},o=0;o<e.length;o++){var s=e[o];t[s._id]=s}for(var n=0;n<r.roles.length;n++){var u=r.roles[n];t[u._id]&&(t[u._id].checked=!0)}}}function d(e,r){for(var t=[],o=0;o<e.length;o++){var s=e[o];s.checked&&t.push(s)}r.roles=t}e.isCreate=!a._id,e.allRoles=i,e.user=a,e.user.roles||(e.user.roles=[]),c(i,a),e.save=function(r){return r?!1:(d(e.allRoles,e.user),e.isCreate?o.createUser(e.user).then(function(){n.open("Пользователь успешно добавлен"),t.go("users-list")},function(e){s.open(e.data,!0)}):o.editUser(e.user).then(function(){n.open("Пользователь успешно сохранен"),t.go("users-list")},function(e){s.open(e.data,!0)}),void 0)},e.lockUser=function(){u.open("Вы действительно хотите заблокировать пользователя?").then(function(){o.lockUser(e.user._id).then(function(){n.open("Пользователь заблокирован"),t.go("edit-user",{id:e.user._id},{reload:!0})},function(e){s.open(e.data,!0)})})},e.unlockUser=function(){u.open("Вы действительно хотите разблокировать пользователя?").then(function(){o.unlockUser(e.user._id).then(function(){n.open("Пользователь разблокирован"),t.go("edit-user",{id:e.user._id},{reload:!0})},function(e){s.open(e.data,!0)})})},e.deleteUser=function(){u.open("Вы действительно хотите удалить пользователя?").then(function(){o.deleteUser(e.user._id).then(function(){n.open("Пользователь удален"),t.go("users-list")},function(e){s.open(e.data,!0)})})},e.removeAllUserDeliveryPoints=function(){u.open("Вы действительно хотите удалить все точки доставки пользователя?").then(function(){o.removeAllUserDeliveryPoints(e.user._id).then(function(){n.open("Все точки доствки пользователя удалены"),t.reload()},function(e){s.open(e.data,!0)})})}}]),angular.module("zakaz-xd.manage-users.users-list",["zakaz-xd.dialogs","zakaz-xd.directives.pagination","zakaz-xd.resources.users-resource","zakaz-xd.auth"]).controller("UsersListCtrl",["$scope","$stateParams","$state","UsersResource","ErrorDialog","InfoDialog",function(e,r,t,o,s){function n(r){o.getAllUsers(r).then(function(r){e.userList=r.data.items,e.pageConfig.count=r.data.count},function(e){s.open(e.data)})}e.userList=[],e.pageConfig={page:1,itemsPerPage:10,pageChanged:function(e,r){n({page:e,itemsPerPage:r})}},n({page:e.pageConfig.page,itemsPerPage:e.pageConfig.itemsPerPage})}]),angular.module("zakaz-xd.orders.edit-order",["zakaz-xd.dialogs","zakaz-xd.resources.orders-resource","zakaz-xd.auth"]).controller("EditOrderCtrl",["$scope","$stateParams","$state","OrdersResource","ErrorDialog","InfoDialog","YesNoDialog","order","user",function(e,r,t,o,s,n,u,a){e.isCreate=!a._id,e.order=a,e.save=function(r){return console.log(r),r?!1:(e.isCreate?o.createOrder(e.order).then(function(){n.open("Ваш заказ успешно создан"),t.go("orders-list")},function(e){s.open(e.data,!0)}):o.editOrder(e.order).then(function(){n.open("Ваш заказ успешно изменен"),t.go("orders-list")},function(e){s.open(e.data,!0)}),void 0)},e.deleteOrder=function(){u.open("Вы действительно хотите удалить заказ?").then(function(){o.deleteOrder(e.order._id).then(function(){n.open("Заказ удален"),t.go("orders-list")},function(e){s.open(e.data,!0)})})}}]),angular.module("zakaz-xd.orders.orders-list",["zakaz-xd.dialogs","zakaz-xd.directives.pagination","zakaz-xd.resources.orders-resource","zakaz-xd.auth"]).controller("OrdersListCtrl",["$scope","$stateParams","$state","OrdersResource","ErrorDialog","InfoDialog","user",function(e,r,t,o,s,n,u){function a(r){o.getAllUserOrders(r).then(function(r){e.orderList=r.data.items,e.pageConfig.count=r.data.count},function(e){s.open(e.data)})}e.user=u,e.orderList=[],e.pageConfig={page:1,itemsPerPage:10,pageChanged:function(e,r){a({page:e,itemsPerPage:r})}},a({page:e.pageConfig.page,itemsPerPage:e.pageConfig.itemsPerPage})}]),angular.module("zakaz-xd.products.edit-product",["zakaz-xd.dialogs","zakaz-xd.resources.products-resource","zakaz-xd.auth","ui.select","ngSanitize"]).controller("EditProductCtrl",["$scope","$stateParams","$state","ProductsResource","ErrorDialog","InfoDialog","YesNoDialog","product","user","allMeasureUnits","allProductTypes",function(e,r,t,o,s,n,u,a,i,c,d){e.isCreate=!a._id,e.product=a,e.allMeasureUnits=c,e.allProductTypes=d,e.save=function(r){return r?!1:(e.isCreate?o.createProduct(e.product).then(function(){n.open("Товар успешно создан"),t.go("products-list")},function(e){s.open(e.data)}):o.editProduct(e.product).then(function(){n.open("Товар успешно изменен"),t.go("products-list")},function(e){s.open(e.data)}),void 0)},e.deleteProduct=function(){u.open("Вы действительно хотите удалить продукт?").then(function(){o.deleteProduct(e.product._id).then(function(){n.open("Продукт удален"),t.go("products-list")},function(e){s.open(e.data,!0)})})}}]),angular.module("zakaz-xd.products.products-list",["zakaz-xd.dialogs","zakaz-xd.directives.pagination","zakaz-xd.resources.products-resource","zakaz-xd.auth"]).controller("ProductsListCtrl",["$scope","$stateParams","$state","ProductsResource","ErrorDialog","InfoDialog","user",function(e,r,t,o,s,n,u){function a(r){o.getAllProducts(r).then(function(r){e.productList=r.data.items,e.pageConfig.count=r.data.count},function(e){s.open(e.data)})}e.user=u,e.productList=[],e.pageConfig={page:1,itemsPerPage:10,pageChanged:function(e,r){a({page:e,itemsPerPage:r})}},a({page:e.pageConfig.page,itemsPerPage:e.pageConfig.itemsPerPage})}]),angular.module("zakaz-xd.user-products.edit-user-product",["zakaz-xd.dialogs","zakaz-xd.resources.user-products-resource","zakaz-xd.resources.user-product-prices-resource","zakaz-xd.resources.users-resource","zakaz-xd.auth","ui.select","ngSanitize"]).controller("EditUserProductCtrl",["$scope","$stateParams","$state","UserProductsResource","UsersResource","UserProductPricesResource","ErrorDialog","InfoDialog","YesNoDialog","userProduct",function(e,r,t,o,s,n,u,a,i,c){function d(r){n.getProductUserPricesByUserProductId(e.userProduct._id,r).then(function(r){e.userProductPrices=r.data.items,e.pageConfig.count=r.data.count},function(e){u.open(e.data)})}e.isCreate=!c._id,e.userProduct=c,s.getAllUsers().then(function(r){e.allUserList=r.data},function(e){u.open(e.data)}),e.isCreate||(e.userProductPrices=[],e.pageConfig={page:1,itemsPerPage:5,pageChanged:function(e,r){d({page:e,itemsPerPage:r})}},d({page:e.pageConfig.page,itemsPerPage:e.pageConfig.itemsPerPage})),e.save=function(r){return r?!1:(e.isCreate?o.createUserProduct(e.userProduct).then(function(){a.open("Связь товара с пользователем успешно создана"),t.go("product-users-list",{id:e.userProduct.product._id})},function(e){u.open(e.data)}):o.editUserProduct(e.userProduct).then(function(){a.open("Изменение связи товара с пользователем успешно"),t.go("product-users-list",{id:e.userProduct.product._id})},function(e){u.open(e.data)}),void 0)},e.delete=function(){i.open("Вы действительно хотите удалить связь продукта и пользователя?").then(function(){o.deleteUserProduct(e.userProduct._id).then(function(){a.open("Связь с пользователем удалена"),t.go("product-users-list",{id:e.userProduct.product._id})},function(e){u.open(e.data,!0)})})}}]),angular.module("zakaz-xd.user-product-prices.edit-user-product-price",["zakaz-xd.dialogs","zakaz-xd.resources.user-products-resource","zakaz-xd.resources.user-product-prices-resource","zakaz-xd.directives.datepicker","zakaz-xd.auth","ui.select","ngSanitize"]).controller("EditUserProductPriceCtrl",["$scope","$stateParams","$state","UserProductsResource","UserProductPricesResource","ErrorDialog","InfoDialog","YesNoDialog","userProductPrice",function(e,r,t,o,s,n,u,a,i){e.isCreate=!i._id,e.userProductPrice=i,e.save=function(r){return r?!1:(console.log("$scope.userProductPrice",e.userProductPrice),e.isCreate?s.createUserProductPrice(e.userProductPrice).then(function(){u.open("Цена на связь пользователь-торвар создана"),t.go("edit-user-product",{userProductId:e.userProductPrice.userProduct._id})},function(e){n.open(e.data)}):s.editUserProductPrice(e.userProductPrice).then(function(){u.open("Изменение цены для связи пользователь-товар успешно"),t.go("edit-user-product",{userProductId:e.userProductPrice.userProduct._id})},function(e){n.open(e.data)}),void 0)},e.delete=function(){a.open("Вы действительно хотите удалить цену на связь пользователь-товар?").then(function(){s.deleteUserProductPrice(e.userProductPrice._id).then(function(){u.open("Цена на связь пользователь-товар удалена"),t.go("edit-user-product",{userProductId:e.userProductPrice.userProduct._id})
},function(e){n.open(e.data,!0)})})}}]),angular.module("zakaz-xd.user-products.product-users-list",["zakaz-xd.dialogs","zakaz-xd.directives.pagination","zakaz-xd.resources.user-products-resource","zakaz-xd.auth"]).controller("ProductUsersListCtrl",["$scope","$stateParams","$state","UserProductsResource","ErrorDialog","InfoDialog","product",function(e,r,t,o,s,n,u){function a(r){o.getProductUsersByProductId(e.product._id,r).then(function(r){e.items=r.data.items,e.pageConfig.count=r.data.count},function(e){s.open(e.data)})}e.product=u,e.items=[],e.pageConfig={page:1,itemsPerPage:10,pageChanged:function(e,r){a({page:e,itemsPerPage:r})}},a({page:e.pageConfig.page,itemsPerPage:e.pageConfig.itemsPerPage})}]),angular.module("zakaz-xd.user-profile.delivery-point",["zakaz-xd.dialogs","zakaz-xd.resources.users-resource","zakaz-xd.auth"]).controller("UserProfileDeliveryPointCtrl",["$scope","$stateParams","$state","UsersResource","ErrorDialog","InfoDialog","YesNoDialog","user","deliveryPoint",function(e,r,t,o,s,n,u,a,i){e.isCreate=!i._id,e.user=a,e.deliveryPoint=i,e.save=function(r){return r?!1:(e.isCreate?o.addCurrentUserDeliveryPoint(e.deliveryPoint).then(function(){n.open("Точка доставки добавлена"),t.go("user-profile")},function(e){s.open(e.data,!0)}):o.updateCurrentUserDeliveryPoint(e.deliveryPoint).then(function(){n.open("Изменение точки доставки успешно"),t.go("user-profile",{id:e.user._id})},function(e){s.open(e.data,!0)}),void 0)},e.delete=function(){u.open("Вы действительно хотите удалить точку доставки?").then(function(){o.removeCurrentUserDeliveryPoint(e.deliveryPoint._id).then(function(){n.open("Точка доставки удалена"),t.go("user-profile")},function(e){s.open(e.data,!0)})})}}]),angular.module("zakaz-xd.manage-users.edit-user.change-password",["zakaz-xd.dialogs","zakaz-xd.resources.users-resource","zakaz-xd.resources.roles-resource","zakaz-xd.auth"]).controller("EditUserChangePasswordCtrl",["$scope","$stateParams","$state","UsersResource","ErrorDialog","InfoDialog","user",function(e,r,t,o,s,n,u){e.user=u,e.data={newPassword:null,repeatNewPassword:null},e.changePassword=function(r){if(r)return!1;if(e.data.newPassword!==e.data.repeatNewPassword)return s.open({message:"Пароли не совпадают"});var u={userId:e.user._id,newPassword:e.data.newPassword,repeatNewPassword:e.data.repeatNewPassword};o.changePassword(u).then(function(){n.open("Пароль пользователя успешно изменен","Изменение пароля"),t.go("users-list")},function(e){s.open(e,!0)})}}]),angular.module("zakaz-xd.manage-users.edit-user.delivery-point",["zakaz-xd.dialogs","zakaz-xd.resources.users-resource","zakaz-xd.auth"]).controller("EditUserDeliveryPointCtrl",["$scope","$stateParams","$state","UsersResource","ErrorDialog","InfoDialog","YesNoDialog","user","deliveryPoint",function(e,r,t,o,s,n,u,a,i){e.isCreate=!i._id,e.user=a,e.deliveryPoint=i,e.save=function(r){return r?!1:(e.isCreate?o.addUserDeliveryPoint(e.user._id,e.deliveryPoint).then(function(){n.open("Точка доставки добавлена"),t.go("edit-user",{id:e.user._id})},function(e){s.open(e.data,!0)}):o.updateUserDeliveryPoint(e.user._id,e.deliveryPoint).then(function(){n.open("Изменение точки доставки успешно"),t.go("edit-user",{id:e.user._id})},function(e){s.open(e.data,!0)}),void 0)},e.delete=function(){u.open("Вы действительно хотите удалить точку доставки?").then(function(){o.removeUserDeliveryPoint(e.user._id,e.deliveryPoint._id).then(function(){n.open("Точка доставки удалена"),t.go("edit-user",{id:e.user._id})},function(e){s.open(e.data,!0)})})}}]);